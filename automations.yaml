- id: "1665816721948"
  alias: Notify - workshop door opened
  description: ""
  triggers:
    - trigger: state
      entity_id:
        - binary_sensor.workshop_door_contact
      from: "off"
      to: "on"
  condition:
    - condition: state
      entity_id: person.patrick
      state: not_home
  actions:
    - action: notify.mobile_app_patricks_iphone
      data:
        title: Door opened
        message: "{{ trigger.to_state.name }} just opened"
        data:
          push:
            sound: Workshop door opened.wav
            interruption-level: time-sensitive
      enabled: true
  mode: single
- id: "1667473720137"
  alias: Blinds close at sunset
  description: ""
  triggers:
    - trigger: numeric_state
      entity_id: sun.sun
      attribute: elevation
      below: -7.3
  condition: []
  actions:
    - action: tts.cloud_say
      data:
        message: Blinds are about to close
        entity_id: media_player.back_lounge
        cache: true
    - delay:
        hours: 0
        minutes: 0
        seconds: 5
        milliseconds: 0
    - action: cover.close_cover
      data: {}
      target:
        entity_id: cover.all_blinds
  mode: single
- id: "1667474758731"
  alias: Blinds open at 6:30AM
  description: ""
  triggers:
    - trigger: numeric_state
      entity_id: sun.sun
      attribute: elevation
      above: 3
      enabled: false
    - trigger: time
      at: 06:30:00
  condition:
    - condition: state
      entity_id: binary_sensor.workday_sensor
      state: "on"
  actions:
    - action: tts.cloud_say
      data:
        entity_id: media_player.back_lounge
        message: Blinds are about to open
    - delay:
        hours: 0
        minutes: 0
        seconds: 5
        milliseconds: 0
    - action: cover.open_cover
      data: {}
      target:
        entity_id: cover.all_blinds
  mode: single
- id: "1668249041786"
  alias: Lights - on at sunset
  description: "just before sunset when sun elevation < +5° "
  triggers:
    - trigger: numeric_state
      entity_id: sun.sun
      attribute: elevation
      below: 5
  conditions: []
  actions:
    - action: light.turn_on
      data: {}
      target:
        entity_id:
          - light.stairs_light
          - light.back_lounge_pendant
          - light.kitchen_pendant
          - light.rear_garden_lights
          - light.front_garden_lights
          - light.pool_light_controller_pool_lights
    - action: light.turn_on
      data:
        brightness_pct: 35
        color_temp_kelvin: 2900
      target:
        entity_id:
          - light.back_lounge_sideboard_lamp
    - action: light.turn_on
      data:
        brightness_pct: 35
        color_temp_kelvin: 358
      target:
        entity_id:
          - light.front_hall_lamp
    - action: light.turn_on
      data:
        brightness_pct: 20
      target:
        entity_id: light.led_strip_front_hall_dimmer
    - action: light.turn_on
      data:
        color_temp_kelvin: 358
        brightness_pct: 18
      target:
        entity_id: light.front_lounge_sideboard_lamp
    - action: light.turn_on
      data:
        brightness_pct: 12
      target:
        entity_id: light.led_strip_kitchen_kicker
    - action: light.turn_on
      data:
        brightness_pct: 35
      target:
        entity_id: light.led_strip_fire_pit_dimmer
    - action: light.turn_on
      data:
        brightness_pct: 50
        color_temp_kelvin: 358
      target:
        entity_id:
          - light.lamp_rhs_fireplace
      enabled: true
    - if:
        - condition: state
          entity_id: input_boolean.sleep_mode
          state: "off"
      then:
        - action: light.turn_on
          data:
            brightness_pct: 25
          target:
            entity_id: light.bedside_lamp_kathleen
  mode: single
- id: "1668760849772"
  alias:
    "Lights - Front yard lights ON when front door open / CCTV line cross / garage
    door opened "
  description: ""
  triggers:
    - trigger: state
      entity_id:
        - input_boolean.driveway_camera_person
      to: "on"
    - trigger: state
      entity_id:
        - input_boolean.front_yard_camera_person
      to: "on"
    - trigger: state
      entity_id:
        - cover.pedestrian_gate
      to: open
    - trigger: state
      entity_id:
        - binary_sensor.garage_door_bottom_magnet
      to: "on"
    - trigger: state
      entity_id:
        - binary_sensor.driveway_light_beam
      to: "on"
    - trigger: state
      entity_id:
        - cover.driveway_gate
      to: opening
    - trigger: state
      entity_id:
        - binary_sensor.front_door_aqara_contact
      to: "on"
    - trigger: state
      entity_id:
        - lock.yale_smartlock_front_door
      to: unlocking
    - trigger: state
      entity_id:
        - lock.yale_smartlock_front_door
      to: unlocked
  conditions:
    - condition: sun
      after: sunset
      before: sunrise
    - condition: state
      entity_id: input_boolean.disable_front_yard_motion_lights
      state: "off"
    - condition: not
      conditions:
        - condition: time
          weekday:
            - wed
            - fri
          before: 07:00:00
          after: 04:15:00
      alias: Not Wed or Fri 4:15AM to 7:00AM
      enabled: false
  actions:
    - data: {}
      target:
        entity_id: light.front_yard_lights
      action: light.turn_on
    - if:
        - condition: state
          entity_id: input_boolean.sleep_mode
          state: "off"
        - condition: time
          after: "17:00:00"
      then:
        - action: light.turn_on
          metadata: {}
          data:
            brightness_pct: 100
          target:
            entity_id: light.main_hall_downlights
      enabled: false
    - delay:
        hours: 0
        minutes: 4
        seconds: 0
        milliseconds: 0
      enabled: false
    - action: light.turn_off
      data:
        transition: 45
      target:
        entity_id: light.main_hall_downlights
      enabled: false
    - delay:
        hours: 0
        minutes: 3
        seconds: 0
        milliseconds: 0
    - data: {}
      target:
        entity_id:
          - light.front_stone_up_down
          - light.front_porch
          - light.meterbox_bunker
          - light.front_north_side_flood
      action: light.turn_off
      enabled: true
    - if:
        - condition: or
          conditions:
            - condition: sun
              after: sunset
              after_offset: 01:30:00
              enabled: true
            - condition: sun
              before: sunrise
      then:
        - data: {}
          target:
            entity_id: light.front_garden_lights
          action: light.turn_off
  mode: restart
- id: "1668816141842"
  alias: Motion - Workshop downlight
  description: Any time of day
  triggers:
    - trigger: state
      entity_id:
        - binary_sensor.workshop_ceiling_motion_occupancy
      from: "off"
      to: "on"
      enabled: true
      id: motion detected
    - trigger: state
      entity_id:
        - binary_sensor.workshop_ceiling_motion_occupancy
      to: "off"
      for:
        hours: 0
        minutes: 4
        seconds: 0
      enabled: true
    - trigger: state
      entity_id:
        - binary_sensor.apollo_msr_2_3574ec_radar_zone_1_occupancy
        - binary_sensor.apollo_msr_2_3574ec_radar_zone_2_occupancy
        - binary_sensor.apollo_msr_2_3574ec_radar_zone_3_occupancy
      to: "on"
      id: motion detected
      enabled: false
    - trigger: state
      entity_id:
        - binary_sensor.apollo_msr_2_3574ec_radar_target
      to: "off"
      for:
        hours: 0
        minutes: 4
        seconds: 0
      enabled: false
    - trigger: state
      entity_id:
        - binary_sensor.everything_presence_lite_22ca80_target_1_active
      to: "on"
      id: motion detected
      enabled: false
    - trigger: state
      entity_id:
        - binary_sensor.everything_presence_lite_22ca80_target_1_active
      to: "off"
      for:
        hours: 0
        minutes: 4
        seconds: 0
      enabled: false
  condition: []
  actions:
    - if:
        - condition: trigger
          id:
            - motion detected
      then:
        - if:
            - condition: state
              entity_id: input_boolean.sleep_mode
              state: "on"
          then:
            - action: light.turn_on
              data:
                brightness_pct: 33
              target:
                entity_id: light.led_strip_workshop_shelf_dimmer
          else:
            - action: light.turn_on
              data:
                brightness_pct: 100
              target:
                entity_id:
                  - light.workshop_downlight
                  - light.led_strip_workshop_shelf_dimmer
      else:
        - action: light.turn_off
          data: {}
          target:
            entity_id:
              - light.workshop_downlight
              - light.led_strip_workshop_shelf_dimmer
  mode: restart
- id: "1668855016367"
  alias: Auto off - all lights and power when last person leaves house
  description: ""
  triggers:
    - trigger: numeric_state
      entity_id: zone.home
      below: 1
  condition:
    - condition: state
      entity_id: sun.sun
      state: above_horizon
  actions:
    - if:
        - condition: state
          entity_id: switch.workshop_power_strip
          state: "on"
      then:
        - action: notify.mobile_app_patricks_iphone
          data:
            message:
              Workshop power strip turned off for safety when last person left
              home
            title: Workshop power strip!
        - action: switch.turn_off
          data: {}
          target:
            entity_id: switch.workshop_power_strip
    - if:
        - condition: state
          entity_id: light.all_lights
          state: "on"
      then:
        - action: notify.mobile_app_patricks_iphone
          data:
            title: All lights off!
            message:
              Turned off {{ states('sensor.number_of_lights_on') }} lights when
              last person left home.
        - action: light.turn_off
          data: {}
          target:
            entity_id: light.all_lights
  mode: single
- id: "1668938565078"
  alias: Light - Back CCTV motion OR alfresco door opens at night
  description: When sun elevation < 0°
  triggers:
    - trigger: state
      entity_id:
        - binary_sensor.alfresco_door_contact
      to: "on"
      enabled: true
      from: "off"
    - trigger: state
      entity_id:
        - input_boolean.back_yard_camera_person
      to: "on"
    - trigger: state
      entity_id:
        - input_boolean.pool_alfresco_camera_person
      to: "on"
  conditions:
    - condition: sun
      after: sunset
      after_offset: -01:00:00
    - condition: time
      before: "21:30:00"
  actions:
    - data: {}
      target:
        entity_id:
          - light.alfresco_downlights
          - light.rear_flood_light
      action: light.turn_on
    - data: {}
      target:
        entity_id:
          - light.laundry_bunker_light
      action: light.turn_on
    - delay:
        hours: 0
        minutes: 4
        seconds: 0
        milliseconds: 0
    - data: {}
      target:
        entity_id:
          - light.alfresco_downlights
          - light.rear_flood_light
          - light.laundry_bunker_light
          - light.courtyard_flood_light
      action: light.turn_off
  mode: single
- id: "1669290456260"
  alias: Notify - Daily solar production report
  description: ""
  triggers:
    - trigger: time
      at: "20:30:00"
  condition: []
  actions:
    - if:
        - condition: numeric_state
          entity_id: sensor.solarnet_energy_day
          above: input_number.max_day_solar_amount
      then:
        - action: input_number.set_value
          target:
            entity_id: input_number.max_day_solar_amount
          data:
            value: "{{ states('sensor.solarnet_energy_day') | float(0) | round(1) }}"
        - action: input_datetime.set_datetime
          target:
            entity_id: input_datetime.max_day_solar_date
          data:
            date: "{{ now().strftime('%Y-%m-%d') }}"
        - action: notify.patrick_and_kathleen
          data:
            title: New solar max!
            message:
              New maximum daily solar this year of {{ states('input_number.max_day_solar_amount')
              | float(0) | round(1) }} kWh
        - action: notify.lg_webos_smart_tv
          data:
            title: New Solar Max!
            message:
              "Solar energy: New maximum daily solar this year of {{ states('input_number.max_day_solar_amount')
              | float(0) | round(1) }} kWh"
      else:
        - action: notify.patrick_and_kathleen
          data:
            title: Solar generated daily report
            message:
              Today you generated {{ states('sensor.solarnet_energy_day') | float(0)
              | round(1) }} kWh.
            data:
              actions:
                - action: URI
                  title: View solar page
                  uri: /lovelace/solar
        - action: notify.lg_webos_smart_tv
          data:
            title: Solar generated daily report
            message:
              Today you generated {{ states('sensor.solarnet_energy_day') | float(0)
              | round(1) }} kWh.
  mode: single
- id: "1669522933161"
  alias: Soldering - workshop soldering irons OFF when NO MOTION
  description: ""
  triggers:
    - trigger: state
      entity_id:
        - switch.workshop_power_strip
      to: "on"
      for:
        hours: 0
        minutes: 30
        seconds: 0
      enabled: false
    - trigger: state
      entity_id:
        - light.workshop_downlight
      to: "off"
      for:
        hours: 0
        minutes: 5
        seconds: 0
  condition:
    - condition: state
      entity_id: switch.workshop_power_strip
      state: "on"
  actions:
    - action: switch.turn_off
      data: {}
      target:
        entity_id: switch.workshop_power_strip
    - action: notify.mobile_app_patricks_iphone
      data:
        title: Workshop soldering iron
        message: Turned off soldering iron becuase workshop downlight off for 5 minutes
    - if:
        - condition: time
          before: "21:30:00"
          after: 07:00:00
      then:
        - action: tts.cloud_say
          data:
            message:
              "Turned off soldering iron becuase\n{% if \"occupancy\" in trigger.entity_id
              -%}\n  no motion for 10 minutes\n{% elif \"power_strip\" in trigger.entity_id
              -%}\n  on for more than 30 minutes\n{% endif %}"
            entity_id: media_player.workshop_speaker
  mode: single
- id: "1669532232781"
  alias: Soldering - Workshop light to RED when soldering iron turned ON
  description: ""
  triggers:
    - trigger: state
      entity_id:
        - switch.workshop_power_strip
      to: "on"
  condition: []
  actions:
    - action: light.turn_on
      target:
        entity_id: light.wled_workshop
      data: {}
      enabled: false
    - action: select.select_option
      target:
        entity_id: select.wled_workshop_preset
      data:
        option: soldering on
      enabled: false
    - action: light.turn_on
      data:
        color_name: red
        brightness_pct: 70
      target:
        entity_id: light.workshop_rgb_light
  mode: single
- id: "1669533897582"
  alias:
    Soldering - Workshop light to BLUE for 2mins then OFF when soldering iron
    turned OFF
  description: ""
  triggers:
    - trigger: state
      entity_id:
        - switch.workshop_power_strip
      to: "off"
  condition: []
  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.wled_workshop
      data: {}
      enabled: false
    - action: select.select_option
      target:
        entity_id: select.wled_workshop_preset
      data:
        option: soldering off
      enabled: false
    - action: number.set_value
      target:
        entity_id: number.wled_workshop_speed
      data:
        value: "125"
      enabled: false
    - action: light.turn_on
      data:
        rgb_color:
          - 82
          - 171
          - 255
        brightness_pct: 50
      target:
        entity_id: light.workshop_rgb_light
      alias: "Light: Workshop RGB light to blue"
    - delay:
        hours: 0
        minutes: 2
        seconds: 0
        milliseconds: 0
    - action: light.turn_off
      data: {}
      target:
        entity_id: light.workshop_rgb_light
    - action: select.select_option
      target:
        entity_id: select.wled_workshop_preset
      data:
        option: Noise 2
      enabled: false
  mode: restart
- id: "1669631569864"
  alias: Lights - House lights ON when anyone arrives home
  description: ""
  triggers:
    - trigger: state
      entity_id:
        - person.patrick
      to: home
    - trigger: state
      entity_id:
        - person.kathleen
      to: home
    - trigger: state
      entity_id:
        - person.jess
      to: home
  conditions:
    - condition: numeric_state
      entity_id: sun.sun
      attribute: elevation
      below: 5
    - condition: time
      after: "16:00:00"
  actions:
    - action: light.turn_on
      data: {}
      target:
        entity_id:
          - light.front_yard_lights
          - light.garage_downlights
    - action: automation.trigger
      data:
        skip_condition: true
      target:
        entity_id: automation.lights_on_at_sunset
    - delay:
        hours: 0
        minutes: 7
        seconds: 0
        milliseconds: 0
    - action: light.turn_off
      data: {}
      target:
        entity_id:
          - light.front_stone_up_down
          - light.front_porch
          - light.meterbox_bunker
          - light.front_north_side_flood
          - light.garage_downlights
          - light.front_lounge_sideboard_lamp
    - if:
        - condition: time
          after: input_datetime.lights_off_time_1
          before: sensor.sun_next_rising
      then:
        - action: light.turn_off
          data: {}
          target:
            entity_id:
              - light.front_garden_lights
              - light.rear_garden_lights
    - if:
        - condition: time
          after: input_datetime.lights_off_time_2
          before: sensor.sun_next_rising
      then:
        - action: light.turn_off
          data: {}
          target:
            entity_id:
              - light.pool_light_controller_pool_lights
              - light.led_strip_fire_pit_dimmer
  mode: restart
- id: "1669710613722"
  alias: Google say - person arrived home
  description: ""
  triggers:
    - trigger: state
      entity_id:
        - person.kathleen
        - person.patrick
      to: home
  conditions:
    - condition: state
      entity_id: input_boolean.sleep_mode
      state: "off"
  actions:
    - action: tts.cloud_say
      data:
        entity_id:
          - media_player.back_lounge_speaker
          - media_player.workshop_speaker
        message: "{{ trigger.entity_id | replace('person.', '') }} is home"
  mode: single
- id: "1669888397242"
  alias: Notify - Leaving home and a door left open
  description: ""
  triggers:
    - trigger: state
      entity_id:
        - zone.home
      to: "0"
  condition:
    - condition: or
      conditions:
        - condition: state
          entity_id: binary_sensor.alfresco_door_contact
          state: "on"
        - condition: state
          entity_id: binary_sensor.front_door_aqara_contact
          state: "on"
  actions:
    - action: notify.patrick_and_kathleen
      data:
        title: Security alert!
        message:
          "{% set doors = [\n   states.binary_sensor.alfresco_door_contact,\n
          \  states.binary_sensor.front_door_aqara_contact ]\n   | selectattr('state',
          'eq', 'on')\n   | map(attribute='name') | list %}\n  {% set qty = doors |
          count %}\n  {% if qty == 0 %}\n    Everything is closed.\n  {% else %}\n    You
          just left home but the following door{{ 's are' if qty > 1 else ' is'}} open:
          {{ doors | join(', ') | replace(\"aqara contact\", \"\") }}\n  {% endif %}"
        data:
          push:
            sound:
              name: default
              critical: 1
              volume: 0.5
  mode: single
- id: "1669961250496"
  alias: Notify - Door opened when nobody is home
  description: ""
  triggers:
    - trigger: state
      entity_id:
        - binary_sensor.alfresco_door_contact
        - binary_sensor.front_door_aqara_contact
        - binary_sensor.workshop_window_contact
      to: "on"
  condition:
    - condition: and
      conditions:
        - condition: state
          entity_id: person.patrick
          state: not_home
        - condition: state
          entity_id: person.kathleen
          state: not_home
      enabled: false
    - condition: numeric_state
      entity_id: zone.home
      below: 1
  actions:
    - action: notify.mobile_app_patricks_iphone
      data:
        title: Intruder Alarm
        message:
          "Nobody is home and the {{ trigger.to_state.name }} door just opened!

          "
        data:
          push:
            sound:
              name:
                "{%- if \"Front\" in trigger.to_state.name -%}\n  US-EN-Morgan-Freeman-Front-Door-Opened.wav\n{%-
                elif \"Alfresco\" in trigger.to_state.name -%}\n  US-EN-Morgan-Freeman-Patio-Door-Opened.wav\n{%-
                endif -%}"
              critical: 1
              volume: 0.5
      enabled: false
    - action: notify.patrick_and_kathleen
      data:
        title: Intruder Alarm
        message:
          'Nobody is home and the {{ trigger.to_state.name | replace("aqara contact",
          "") }} just opened!

          '
        data:
          push:
            sound:
              name: default
              critical: 1
              volume: 0.5
  mode: single
- id: "1670040126536"
  alias: Notify - Garage door closed
  description: ""
  triggers:
    - trigger: state
      entity_id:
        - binary_sensor.garage_door_bottom_magnet
      to: "off"
      for:
        hours: 0
        minutes: 0
        seconds: 0
  condition:
    - condition: state
      state: not_home
      entity_id: person.patrick
      enabled: false
  actions:
    - action: notify.mobile_app_patricks_iphone
      data:
        title: Garage Door!
        message:
          '{{ trigger.to_state.name | replace(" Bottom Magnet", "")}} has closed

          '
        data:
          push:
            sound: US-EN-Morgan-Freeman-Garage-Door-Closed.wav
            interruption-level: time-sensitive
      enabled: true
  mode: single
- id: "1670132740049"
  alias: Notify - Shelly getting hot (> 60°C)
  description: ""
  triggers:
    - trigger: numeric_state
      entity_id:
        - sensor.alfresco_downlights_device_temperature
        - sensor.pool_perimeter_downlights_device_temperature
        - sensor.back_lounge_downlights_device_temperature
        - sensor.stairs_and_dining_device_temperature
        - sensor.dining_pendant_and_spare_device_temperature
        - sensor.front_stone_up_down_device_temperature
        - sensor.meterbox_bunker_device_temperature
        - sensor.front_porch_downlights_device_temperature
        - sensor.north_side_flood_light_device_temperature
        - sensor.front_lounge_downlight_device_temperature
        - sensor.front_lounge_pendant_device_temperature
        - sensor.kitchen_downlights_device_temperature
        - sensor.kitchen_pendant_and_spare_device_temperature
        - sensor.laundry_bunker_light_device_temperature
        - sensor.laundry_downlight_device_temperature
        - sensor.rear_flood_and_garden_lights_device_temperature
        - sensor.wir_downlight_device_temperature
        - sensor.butlers_downlight_temperature
        - sensor.garage_lights_temperature
        - sensor.lounge_pendant_temperature
        - sensor.workshop_downlight_device_temperature
      for:
        hours: 0
        minutes: 7
        seconds: 0
      above: 60
  condition: []
  actions:
    - action: notify.mobile_app_patricks_iphone
      data:
        title: Shelly temperature
        message:
          'Shelly "{{ trigger.to_state.name | replace(" Device Temperature",
          "") }}" is {{ trigger.to_state.state }}°C. {{ ''\n'' -}} [Above trigger of
          {{ trigger.above }}°C for {{ (((trigger.for.seconds) | int) / 60) | round(0)
          }} minutes.]

          '
  mode: single
- id: "1670664345843"
  alias: "Notify - Calendar: Put bins out"
  description: ""
  triggers:
    - trigger: calendar
      event: start
      offset: -0:0:0
      entity_id: calendar.rubbish_bins
  condition: []
  actions:
    - action: notify.mobile_app_patricks_iphone
      data:
        title: Calendar notification
        message:
          Put out {{ trigger.calendar_event.summary }} for collection tomorrow
          morning. {{ trigger.calendar_event.start | as_timestamp | timestamp_custom('%I:%M
          %p') }}
    - action: tts.cloud_say
      data:
        entity_id:
          - media_player.back_lounge
          - media_player.workshop_speaker
        message:
          Put out {{ trigger.calendar_event.summary }} for collection tomorrow
          morning.
  mode: queued
  max: 10
- id: "1671250102998"
  alias: Input booleans and automations - Reset at 7am
  description: ""
  triggers:
    - trigger: time
      at: 07:00:00
  conditions: []
  actions:
    - data: {}
      target:
        entity_id:
          - input_boolean.grid_power_alert
          - input_boolean.garage_door_alerts
      action: input_boolean.turn_on
    - metadata: {}
      data: {}
      target:
        entity_id:
          - automation.door_open_alfresco_turn_on_alfresco_lights
          - automation.notify_motion_in_front_yard
          - automation.front_door_open_turn_front_yard_lights_on
          - automation.lights_front_yard_lights_on_when_anyone_arrives_home
          - automation.air_con_on_when_hot_back_lounge_people_at_home_v2
          - automation.automatic_open_garage_and_gate_when_kathleen_arrives_home_in_when_driving
          - automation.automatic_open_garage_when_person_arrives_home_in_when_driving
      action: automation.turn_on
  mode: single
- id: "1671333862212"
  alias: Google say - Workshop CO2 level getting high
  description: ""
  triggers:
    - trigger: numeric_state
      entity_id: sensor.co2_workshop_core2_sensor
      above: 700
  condition:
    - condition: time
      before: "22:30:00"
      after: 07:00:00
  actions:
    - action: fan.turn_on
      data: {}
      target:
        entity_id: fan.workshop_ceiling_fan
    - action: tts.cloud_say
      data:
        entity_id: media_player.workshop_speaker
        message:
          Workshop carbon dioxide getting high, it's above {{ trigger.above |
          float | round(0) }}
    - delay:
        hours: 0
        minutes: 5
        seconds: 0
        milliseconds: 0
    - repeat:
        until:
          - condition: numeric_state
            entity_id: sensor.co2_workshop_core2_sensor
            below: 600
        sequence:
          - action: tts.cloud_say
            data:
              entity_id: media_player.workshop_speaker
              message:
                Workshop carbon dioxide is still high at {{ states('sensor.co2_workshop_core2_sensor')
                | float | round(0) }}
          - delay:
              hours: 0
              minutes: 5
              seconds: 0
              milliseconds: 0
    - action: fan.turn_off
      data: {}
      target:
        entity_id: fan.workshop_ceiling_fan
  mode: single
- id: "1672344646174"
  alias: Lights - Side lights when Courtyard CCTV motion
  description: When sun elevation is < 0°
  triggers:
    - trigger: state
      entity_id:
        - input_boolean.courtyard_camera_person
      to: "on"
  conditions:
    - condition: sun
      after: sunset
      after_offset: -01:00:00
    - condition: time
      before: "21:30:00"
  actions:
    - data: {}
      target:
        entity_id:
          - light.laundry_bunker_light
      action: light.turn_on
    - action: light.turn_on
      metadata: {}
      data: {}
      target:
        entity_id: light.courtyard_flood_light
    - delay:
        hours: 0
        minutes: 4
        seconds: 0
        milliseconds: 0
    - data: {}
      target:
        entity_id:
          - light.laundry_bunker_light
          - light.courtyard_flood_light
      action: light.turn_off
  mode: restart
- id: "1674383678869"
  alias: Octoprint 50% complete
  description: ""
  triggers:
    - trigger: numeric_state
      entity_id: sensor.octoprint_job_percentage
      above: 50
  condition: []
  actions:
    - action: notify.mobile_app_patricks_iphone
      data:
        title: 3D Printer
        message: 3D print is 50% complete
  mode: single
- id: "1674384425478"
  alias: Octoprint - print finished
  description: ""
  triggers:
    - trigger: state
      entity_id:
        - sensor.octoprint_current_state
      from: Printing
      to: Operational
  condition: []
  actions:
    - action: notify.mobile_app_patricks_iphone
      data:
        title: 3D Printer
        message: Print has finished!
        data:
          push:
            sound: HummingbirdCompletion_Haptic.caf
            interruption-level: time-sensitive
    - action: fan.turn_off
      data: {}
      target:
        entity_id: fan.workshop_ceiling_fan
  mode: single
- id: "1674775378226"
  alias: Notify - leaving home and front door unlocked
  description: ""
  triggers:
    - trigger: state
      entity_id:
        - zone.home
      to: "0"
  condition:
    - condition: state
      entity_id: lock.yale_smartlock_front_door
      state: unlocked
  actions:
    - action: notify.mobile_app_patricks_iphone
      data:
        title: Security alert!
        message:
          You just left home but the front door is unlocked! Will try and lock
          it now, but please go home and double check it.
        data:
          push:
            sound:
              name: default
              critical: 1
              volume: 0.5
    - if:
        - condition: state
          entity_id: binary_sensor.front_door_aqara_contact
          state: "off"
          alias: Confirm front door is closed
      then:
        - action: lock.lock
          data: {}
          target:
            entity_id:
              - lock.yale_smartlock_front_door
  mode: single
- id: "1674880600732"
  alias: Notify - UPS battery low (not required, done by NUT UPS add-on option)
  description: ""
  triggers:
    - trigger: numeric_state
      entity_id: sensor.ups_battery_charge
      below: 5
  condition: []
  actions:
    - action: hassio.host_shutdown
      data: {}
    - action: notify.mobile_app_patricks_iphone
      data:
        title: Power Outage
        message:
          "UPS battery is below {{ trigger.below }}% so shutting down home assistant.

          "
  mode: single
- id: "1674888763657"
  alias: Notify - UPS state change
  description: ""
  triggers:
    - trigger: event
      event_type: nut.ups_event
  condition: []
  actions:
    - action: notify.mobile_app_patricks_iphone
      data_template:
        title: UPS {{ trigger.event.data.notify_type }}
        message:
          "{% set ups_msg = trigger.event.data.notify_msg | replace('UPS@localhost
          ', '') %} {% if 'battery' in ups_msg %}\n  Power outage! Running on UPS.\n{%
          elif 'line' in ups_msg %}\n  Power restored. UPS charging.\n{% endif -%} {%
          set ups_msg_2 = (states('sensor.ups_battery_charge') | int) %} Battery level
          is  {%- if ups_msg_2 is number %}\n  {{ ups_msg_2 }}%\n{% else %}\n  {{ states('sensor.ups_battery_charge')
          }}\n{% endif -%}\n"
  mode: single
- id: "1675156383173"
  alias: Notify - Leaving home and a window left open
  description: ""
  triggers:
    - trigger: state
      entity_id:
        - zone.home
      to: "0"
  condition:
    - condition: or
      conditions:
        - condition: state
          entity_id: binary_sensor.workshop_window_contact
          state: "on"
  actions:
    - action: notify.patrick_and_kathleen
      data:
        title: Security alert!
        message:
          "{% set windows = [\n   states.binary_sensor.workshop_window_contact
          ]\n   | selectattr('state', 'eq', 'on')\n   | map(attribute='name') | list
          %}\n  {% set qty = windows | count %}\n  {% if qty == 0 %}\n    Everything
          is closed.\n  {% else %}\n    You just left home but the following window{{
          's are' if qty > 1 else ' is' }} open: {{ windows | join(', ') }}\n  {% endif
          %}"
        data:
          push:
            sound:
              name: default
              critical: 1
              volume: 0.5
  mode: single
- id: "1675158213480"
  alias: Notify - Water leak
  description: ""
  triggers:
    - trigger: state
      entity_id:
        - binary_sensor.dishwasher_leak_sensor_water_leak
        - binary_sensor.washing_machine_leak_sensor_water_leak
      to: "on"
      from: "off"
  condition: []
  actions:
    - action: tts.cloud_say
      data:
        entity_id:
          - media_player.back_lounge
          - media_player.workshop_speaker
        message:
          Water is leaking in the {{ trigger.to_state.name | replace("leak sensor
          water leak", "") }}
    - action: notify.patrick_and_kathleen
      data:
        title: Water Leak!
        message:
          Water is leaking in the {{ trigger.to_state.name | replace("leak sensor
          water leak", "") }}
        data:
          push:
            interruption-level: critical
  mode: single
- id: "1677320260752"
  alias: Lights - garden lights off (first time of day)
  description: ""
  triggers:
    - trigger: time
      at: input_datetime.lights_off_time_1
      enabled: true
    - trigger: sun
      event: sunset
      offset: 01:30:00
      enabled: false
  condition: []
  actions:
    - action: light.turn_off
      data: {}
      target:
        entity_id:
          - light.front_garden_lights
          - light.rear_garden_lights
          - light.front_lounge_sideboard_lamp
  mode: single
- id: "1678303773548"
  alias: Light - Courtyard follows bunker light
  description: ""
  triggers:
    - trigger: state
      entity_id:
        - light.laundry_bunker_light
      to: "on"
      id: light on
    - trigger: state
      entity_id:
        - light.laundry_bunker_light
      to: "off"
      id: light off
  condition: []
  actions:
    - if:
        - condition: trigger
          id:
            - light on
      then:
        - action: light.turn_on
          data: {}
          target:
            entity_id: light.courtyard_flood_light
      else:
        - action: light.turn_off
          data: {}
          target:
            entity_id:
              - light.courtyard_flood_light
  mode: single
- id: "1678589815500"
  alias: Notify - Home power consumption is high
  description: ""
  triggers:
    - trigger: numeric_state
      entity_id:
        - sensor.solarnet_power_grid
      for:
        hours: 0
        minutes: 20
        seconds: 0
      above: 4
  condition:
    - condition: state
      entity_id: input_boolean.grid_power_alert
      state: "on"
  actions:
    - repeat:
        until:
          - condition: or
            conditions:
              - condition: state
                entity_id: input_boolean.grid_power_alert
                state: "off"
              - condition: numeric_state
                entity_id: sensor.solarnet_power_grid
                below: 0.8
        sequence:
          - variables:
              action_disable: "{{ 'DISABLE_' ~ context.id }}"
          - action: notify.mobile_app_patricks_iphone
            data:
              title: Drawing excessive power from the grid for 15 mins!
              message:
                "Grid import power is now: {{ states('sensor.solarnet_power_grid')
                | round(1) }} kW"
              data:
                push:
                  sound: 3rdParty_Failure_Haptic.caf
                  interruption-level: time-sensitive
                actions:
                  - action: "{{ action_disable }}"
                    title: Disable these notifications
                  - action: URI
                    title: Go to energy page in HA
                    uri: /lovelace/solar
          - wait_for_trigger:
              - trigger: event
                event_type: mobile_app_notification_action
                event_data:
                  actions: "{{ action_disable }}"
            timeout:
              hours: 0
              minutes: 1
              seconds: 0
              milliseconds: 0
          - choose:
              - conditions:
                  - condition: template
                    value_template: "{{ wait.trigger.event.data.action == action_disable }}"
                sequence:
                  - action: input_boolean.turn_off
                    target:
                      entity_id: input_boolean.grid_power_alert
                    data: {}
                  - stop: Stopped the repeat loop by user actionable notification
          - delay:
              hours: 0
              minutes: 14
              seconds: 0
              milliseconds: 0
      enabled: false
    - action: notify.mobile_app_patricks_iphone
      data:
        title: High Power Usage
        message:
          "Grid import power is now: {{ states('sensor.solarnet_power_grid')
          | round(1) }} kW. Consider turning off some appliances."
        data:
          push:
            sound: 3rdParty_Failure_Haptic.caf
            interruption-level: time-sensitive
  mode: restart
- id: "1678699026931"
  alias: Lights - pool & fire-pit lights off (second time of day)
  description: ""
  triggers:
    - trigger: time
      at: input_datetime.lights_off_time_2
      enabled: true
    - trigger: sun
      event: sunset
      offset: 02:00:00
      enabled: false
  condition: []
  actions:
    - action: light.turn_off
      data: {}
      target:
        entity_id:
          - light.pool_light_controller_pool_lights
          - light.led_strip_fire_pit_dimmer
  mode: single
- id: "1679693076266"
  alias: Automatic - open garage and gate when PATRICK arrives home in when driving
  description: ""
  triggers:
    - trigger: state
      entity_id:
        - device_tracker.fsc_bp104d_pat
      to: home
      enabled: true
  conditions:
    - condition: state
      entity_id: sensor.patricks_iphone_activity
      state: Automotive
    - condition: template
      value_template:
        "{{ now() - state_attr('automation.automatic_open_garage_and_gate_when_kathleen_arrives_home_in_when_driving',
        'last_triggered') > timedelta(seconds=30) }}"
    - condition: state
      entity_id: cover.driveway_gate
      state: closed
  actions:
    - action: script.open_gate_and_garage
      data: {}
    - action: notify.mobile_app_patricks_iphone
      data:
        title: Arrived Home - BLE Beacon
        message:
          You just arrived home - triggered by BLE beacon ({{ (now()) | as_timestamp
          | timestamp_custom('%I:%M:%S %p') }})
      enabled: false
  mode: single
- id: "1679726945385"
  alias: Automatic - open garage and gate when KATHLEEN arrives home in when driving
  description: ""
  triggers:
    - trigger: state
      entity_id:
        - device_tracker.fsc_bp104d_kat
      to: home
      enabled: true
  conditions:
    - condition: state
      entity_id: sensor.kathleens_iphone_activity
      state: Automotive
    - condition: template
      value_template:
        "{{ now() - state_attr('automation.automatic_open_garage_when_person_arrives_home_in_when_driving',
        'last_triggered') > timedelta(seconds=30) }}"
    - condition: state
      entity_id: cover.driveway_gate
      state: closed
  actions:
    - action: script.open_gate_and_garage
      data: {}
  mode: single
- id: "1680405230305"
  alias: Octoprint - Start
  description: ""
  triggers:
    - trigger: state
      entity_id:
        - sensor.octoprint_current_state
      from: Operational
      to: Printing
  condition: []
  actions:
    - action: notify.mobile_app_patricks_iphone
      data:
        title: 3D Print Start
        message: 3D print started, turning on workshop fan
        data:
          push:
            sound: HummingbirdCompletion_Haptic.caf
            interruption-level: time-sensitive
    - action: fan.turn_on
      data: {}
      target:
        entity_id: fan.workshop_ceiling_fan
  mode: single
- id: "1680482830475"
  alias: Automatic - Close garage and gate if nobody home more than 2 mins
  description: ""
  triggers:
    - trigger: state
      entity_id:
        - cover.driveway_gate
      to: open
      for:
        hours: 0
        minutes: 2
        seconds: 0
    - trigger: state
      entity_id:
        - cover.garage_door
      to: open
      for:
        hours: 0
        minutes: 2
        seconds: 0
  condition:
    - condition: state
      entity_id: person.kathleen
      state: not_home
    - condition: state
      entity_id: person.patrick
      state: not_home
  actions:
    - action: script.close_gate_and_garage
      data: {}
    - action: notify.mobile_app_patricks_iphone
      data:
        message:
          Gate and Garage automatically closed because nobody home more than
          2 mins
        title: Auto close garage and gate
  mode: single
- id: "1680685928321"
  alias: Lights - vacation - all off at approx 10:30pm
  description: ""
  triggers:
    - trigger: time
      at: "22:30:00"
  condition: []
  actions:
    - delay:
        hours: 0
        minutes: "{{ range(0,30) | random }}"
        seconds: 0
        milliseconds: 0
    - action: light.turn_off
      data: {}
      target:
        entity_id: light.all_lights
    - action: climate.turn_off
      data: {}
      target:
        entity_id: climate.ac
    - action: notify.mobile_app_patricks_iphone
      data:
        title: Vacation - lights and A/C off
        message:
          "Turned lights and A/C off a random 30 mins after 10:30pm ({{ now()
          | as_timestamp | timestamp_custom('%I:%M:%S %p') }})

          "
  mode: single
- id: "1681603029589"
  alias: Notify - Washing machine actions
  description: Notify start/finish based on electrical power
  use_blueprint:
    path: sbyx/notify-or-do-something-when-an-appliance-like-a-dishwasher-or-washing-machine-finishes.yaml
    input:
      power_sensor: sensor.washing_machine_current_consumption
      starting_threshold: 100
      actions:
        - action: notify.patrick_and_kathleen
          data:
            title: Washing machine finish
            message:
              "Washing machine finished - please hang out ({{ (now()) | as_timestamp
              | timestamp_custom('%I:%M %p') }})

              "
        - if:
            - condition: sun
              before: sunset
          then:
            - action: light.turn_on
              data:
                color_name: purple
                brightness_pct: 100
              target:
                entity_id: light.back_lounge_sideboard_lamp
          else:
            - action: light.turn_on
              data:
                color_name: purple
                brightness_pct: 50
              target:
                entity_id: light.back_lounge_sideboard_lamp
        - action: notify.lg_webos_smart_tv
          data:
            title: Washing machine finished
            message:
              Washing machine finished - please hang out ({{ (now()) | as_timestamp
              | timestamp_custom('%I:%M %p') }})
      pre_actions:
        - action: notify.mobile_app_patricks_iphone
          data:
            title: Washing machine started
            message: Sit back and relax while the machines do your work!
          enabled: false
      starting_hysteresis: 5
      finishing_threshold: 1
- id: "1681615571224"
  alias: Ensuite fan - control by humidity (notify for testing)
  description: Based on humidity sensor
  triggers:
    - trigger: template
      value_template:
        "{% set humid = states('sensor.ensuite_environmental_humidity')|int
        %}

        {% set humid_ave = states('sensor.ensuite_humidity_average_linear_24h')|int
        %}

        {{ humid > humid_ave + 5 }}"
      for:
        hours: 0
        minutes: 0
        seconds: 30
  condition: []
  actions:
    - action: notify.mobile_app_patricks_iphone
      data:
        title: Ensuite shower
        message:
          Shower is now on because ensuite humidity is 5% above 24hr average
          of {{ states('sensor.ensuite_humidity_average_linear_24h', with_unit=True)
          }}
  mode: single
- id: "1682297014844"
  alias: Ensuite fan - control by humidity
  description: ""
  use_blueprint:
    path: Blackshome/bathroom-humidity-exhaust-fan.yaml
    input:
      triggers: sensor.ensuite_humidity_rate_of_change
      rising_humidity: 1.5
      falling_humidity: -1
      by_pass: sensor.ensuite_humidity_rate_of_change
      include_ha_restart: restart_enabled
      fan_switch:
        entity_id: switch.ensuite_fan
      bathroom_humidity_sensor: sensor.ensuite_environmental_humidity
      include_max_humidity: maximum_humidity_enabled
      time_delay: 1
      time_out: 8
      include_winter_mode: winter_mode_enabled
      month_winter_mode:
        - "6"
        - "7"
        - "8"
        - "5"
        - "9"
      winter_rising_humidity: 1.5
      winter_time_out: 8
      winter_time_delay: 1
      winter_include_max_humidity: maximum_humidity_enabled
      include_manual_fan_switch: enable_manual_fan_switch_auto_off
      manual_fan_switch_time_delay: 20
- id: "1682297394195"
  alias: Ensuite fan - control by humidity (notify for testing)
  description: ""
  triggers:
    - trigger: numeric_state
      entity_id: sensor.ensuite_humidity_rate_of_change
      above: 2.7
  condition: []
  actions:
    - action: notify.mobile_app_patricks_iphone
      data:
        message: Ensuite fan ON
    - wait_for_trigger:
        - trigger: numeric_state
          entity_id: sensor.ensuite_humidity_rate_of_change
          below: -1.5
      continue_on_timeout: false
      timeout:
        hours: 0
        minutes: 30
        seconds: 0
        milliseconds: 0
    - action: notify.mobile_app_patricks_iphone
      data:
        message: Ensuite fan OFF
  mode: single
- id: "1683635574099"
  alias: Auto off - gas heater when last person leaves home
  description: ""
  triggers:
    - trigger: numeric_state
      entity_id: zone.home
      below: 0
  condition: []
  actions:
    - action: switch.turn_off
      data: {}
      target:
        entity_id: switch.gas_heater
  mode: single
- id: "1684844548755"
  alias: CCTV Motion critical alert during sleep
  description: ""
  triggers:
    - trigger: state
      entity_id:
        - input_boolean.driveway_camera_person
      to: "on"
      id: front yard
    - trigger: state
      entity_id:
        - input_boolean.front_yard_camera_person
      to: "on"
      id: front yard
    - trigger: state
      entity_id:
        - binary_sensor.driveway_light_beam
      to: "on"
      id: front yard
    - trigger: state
      entity_id:
        - input_boolean.pool_alfresco_camera_person
      to: "on"
      id: back yard
      enabled: false
    - trigger: state
      entity_id:
        - input_boolean.back_yard_camera_person
      to: "on"
      id: back yard
      enabled: false
    - trigger: state
      entity_id:
        - input_boolean.courtyard_camera_person
      to: "on"
      id: back yard
      enabled: false
  conditions:
    - condition: state
      entity_id: input_boolean.sleep_mode
      state: "on"
    - condition: state
      entity_id: input_boolean.disable_cctv_critical_alerts
      state: "off"
    - condition: template
      value_template:
        "{{ now() - states.cover.driveway_gate.last_changed > timedelta(seconds=120)
        }}"
    - condition: template
      value_template:
        "{{ now() - states.cover.garage_door.last_changed > timedelta(seconds=120)
        }}"
    - condition: not
      conditions:
        - condition: time
          weekday:
            - wed
            - fri
          before: 07:00:00
          after: 04:15:00
      alias: Not Wed or Fri 4:15AM to 7:00AM
      enabled: false
  actions:
    - choose:
        - conditions:
            - condition: trigger
              id:
                - front yard
          sequence:
            - data:
                title: CCTV motion
                message:
                  "{% if trigger is defined %}\n  {{ trigger.to_state.attributes.friendly_name
                  }} at {{\n  trigger.to_state.last_updated | as_timestamp | timestamp_custom('%I:%M
                  %p')\n  }}\n{% else %}\n  Manual Run at {{ now() | as_timestamp | timestamp_custom('%I:%M
                  %p') }}\n{% endif %}"
                data:
                  push:
                    sound:
                      name: US-EN-Alexa-Motion-In-Front-Yard.wav
                      critical: 1
                      volume: 0.3
                  actions:
                    - action: URI
                      title: Go to CCTV page in HA
                      uri: /lovelace/cctv
              action: notify.patrick_and_kathleen
            - action: light.turn_on
              metadata: {}
              data: {}
              target:
                entity_id: light.front_yard_lights
            - delay:
                hours: 0
                minutes: 4
                seconds: 0
                milliseconds: 0
            - action: light.turn_off
              target:
                entity_id:
                  - light.front_yard_lights
              data: {}
        - conditions:
            - condition: trigger
              id:
                - back yard
          sequence:
            - data:
                title: CCTV motion
                message:
                  "{% if trigger is defined %}\n  {{ trigger.to_state.attributes.friendly_name
                  }} at {{\n  trigger.to_state.last_updated | as_timestamp | timestamp_custom('%I:%M
                  %p')\n  }}\n{% else %}\n  Manual Run at {{ now() | as_timestamp | timestamp_custom('%I:%M
                  %p') }}\n{% endif %}"
                data:
                  push:
                    sound:
                      name: US-EN-Alexa-Motion-In-Back-Yard.wav
                      critical: 1
                      volume: 0.3
                  actions:
                    - action: URI
                      title: Go to CCTV page in HA
                      uri: /lovelace/cctv
              action: notify.patrick_and_kathleen
            - action: light.turn_on
              metadata: {}
              data: {}
              target:
                entity_id:
                  - light.back_yard_lights
                  - light.courtyard_flood_light
                  - light.laundry_bunker_light
            - delay:
                hours: 0
                minutes: 4
                seconds: 0
                milliseconds: 0
            - action: light.turn_off
              target:
                entity_id:
                  - light.back_yard_lights
                  - light.courtyard_flood_light
                  - light.laundry_bunker_light
              data: {}
    - delay:
        hours: 0
        minutes: 0
        seconds: 20
        milliseconds: 0
  mode: single
- id: "1685061501391"
  alias: Input boolean - Enable front yard motion alerts after 1 hour
  description: ""
  triggers:
    - trigger: event
      event_type: timer.finished
      event_data:
        entity_id: timer.remaining_time_front_yard_motion_alerts_disabled
  condition:
    - condition: state
      entity_id: input_boolean.disable_cctv_critical_alerts
      state: "on"
  actions:
    - action: input_boolean.turn_off
      data: {}
      target:
        entity_id: input_boolean.disable_cctv_critical_alerts
  mode: single
- id: "1685061918531"
  alias: Timer - remaining time to enable front yard motion alerts
  description: ""
  triggers:
    - trigger: state
      entity_id:
        - input_boolean.disable_cctv_critical_alerts
  condition: []
  actions:
    - choose:
        - conditions:
            - condition: state
              entity_id: input_boolean.disable_cctv_critical_alerts
              state: "on"
          sequence:
            - action: timer.start
              data: {}
              target:
                entity_id: timer.remaining_time_front_yard_motion_alerts_disabled
        - conditions:
            - condition: state
              entity_id: input_boolean.disable_cctv_critical_alerts
              state: "off"
          sequence:
            - action: timer.finish
              data: {}
              target:
                entity_id: timer.remaining_time_front_yard_motion_alerts_disabled
  mode: single
- id: "1685102688097"
  alias: Input boolean - Enable front yard motion lights after 5 mins
  description: ""
  triggers:
    - trigger: event
      event_type: timer.finished
      event_data:
        entity_id: timer.remaining_time_front_yard_motion_lights_disabled
  condition:
    - condition: state
      entity_id: input_boolean.disable_front_yard_motion_lights
      state: "on"
  actions:
    - action: input_boolean.turn_off
      data: {}
      target:
        entity_id:
          - input_boolean.disable_front_yard_motion_lights
  mode: single
- id: "1685103116029"
  alias: Timer - remaining time to enable front yard lights
  description: ""
  triggers:
    - trigger: state
      entity_id:
        - input_boolean.disable_front_yard_motion_lights
  condition: []
  actions:
    - choose:
        - conditions:
            - condition: state
              entity_id: input_boolean.disable_front_yard_motion_lights
              state: "on"
          sequence:
            - action: timer.start
              data: {}
              target:
                entity_id:
                  - timer.remaining_time_front_yard_motion_lights_disabled
        - conditions:
            - condition: state
              entity_id: input_boolean.disable_front_yard_motion_lights
              state: "off"
          sequence:
            - action: timer.finish
              data: {}
              target:
                entity_id:
                  - timer.remaining_time_front_yard_motion_lights_disabled
  mode: single
- id: "1685241223269"
  alias: Notify - Yale lock, unlocked with keypad PIN
  description: ""
  triggers:
    - trigger: template
      value_template:
        "{{ is_state('sensor.yale_smartlock_front_door_action', 'unlock')
        and is_state('sensor.yale_smartlock_front_door_action_source_name', 'keypad')
        }}

        "
  condition: []
  actions:
    - action: notify.mobile_app_patricks_iphone
      data:
        title: Yale front door lock
        message: "Unlocked with kaypad PIN

          "
  mode: single
- id: "1689412431203"
  alias: Air con turn off timer
  description: ""
  triggers:
    - trigger: state
      entity_id:
        - input_number.air_con_off_timer
    - trigger: state
      entity_id:
        - input_button.set_air_con_off_timer
  condition: []
  actions:
    - action: climate.turn_on
      data: {}
      target:
        entity_id: climate.ac
    - delay:
        hours: 0
        minutes: 0
        seconds: 2
        milliseconds: 0
    - action: advantage_air.set_time_to
      data:
        minutes: "{{ states('input_number.air_con_off_timer') }}

          "
      target:
        entity_id: sensor.ac_time_to_off
  mode: single
- id: "1693651577831"
  alias: Auto off - Pool robot (Shelly) when power drops to zero
  description:
    Robot turns itself off after 2 hrs, even with Shelly switch power applied.
    So this is to turn Shelly output off.
  triggers:
    - trigger: numeric_state
      entity_id: sensor.pool_robot_power
      below: 4
      for:
        hours: 0
        minutes: 0
        seconds: 30
  conditions: []
  actions:
    - action: switch.turn_off
      data: {}
      target:
        entity_id: switch.pool_robot
    - action: notify.mobile_app_patricks_iphone
      data:
        title: "Pool robot cleaner \U0001F3CA \U0001F916"
        message:
          Turned off pool cleaner because power dropped below {{ trigger.below
          }} Watts for 30 seconds.
    - if:
        - condition: state
          entity_id: input_boolean.sleep_mode
          state: "off"
      then:
        - action: tts.cloud_say
          data:
            cache: true
            entity_id: media_player.back_lounge
            message: Pool robot just turned off
  mode: single
- id: "1693826918399"
  alias: Pool heater and pump - turn ON when grid export power > 2.1kW
  description: ""
  triggers:
    - trigger: template
      value_template: "{{ states('sensor.solarnet_power_grid')|float < -2.1 }}"
      id: trigger_power
      for:
        hours: 0
        minutes: 6
        seconds: 0
  conditions:
    - condition: state
      entity_id: climate.rostrevor_pool
      state: "off"
    - condition: state
      entity_id: switch.pool_pump
      state: "on"
      enabled: false
  actions:
    - metadata: {}
      data: {}
      target:
        entity_id: switch.pool_pump
      action: switch.turn_on
    - delay:
        hours: 0
        minutes: 0
        seconds: 5
        milliseconds: 0
    - data:
        hvac_mode: heat
      target:
        entity_id: climate.rostrevor_pool
      action: climate.set_hvac_mode
    - data: {}
      target:
        entity_id: climate.rostrevor_pool
      action: climate.turn_on
    - data:
        title: Pool heater
        message:
          Turned on pool pump and heater because exporting more than 2.1kW ({{
          -(trigger.to_state.state | float | round(1)) }}kW) and pump is ON.
      action: notify.mobile_app_patricks_iphone
      enabled: false
  mode: single
- id: "1693827066966"
  alias:
    Pool heater and pump - turn OFF when grid importing for 20 mins or pool pump
    turns OFF
  description: ""
  triggers:
    - trigger: numeric_state
      entity_id:
        - sensor.solarnet_power_grid
      for:
        hours: 0
        minutes: 10
        seconds: 0
      above: 0.5
      id: not enough power
    - trigger: state
      entity_id:
        - switch.pool_pump
      to: "off"
      id: pump_off
  conditions:
    - condition: state
      entity_id: climate.rostrevor_pool
      state: heat
  actions:
    - data: {}
      target:
        entity_id: climate.rostrevor_pool
      action: climate.turn_off
    - choose:
        - conditions:
            - condition: trigger
              id:
                - not enough power
          sequence:
            - if:
                - condition: time
                  after: "17:00:00"
              then:
                - action: switch.turn_off
                  metadata: {}
                  data: {}
                  target:
                    entity_id: switch.pool_pump
                - data:
                    title: Pool heater
                    message:
                      Turned off pool pump because after 5PM and importing power from
                      grid for {{ (((trigger.for.seconds) | int) / 60) | round(0) }} minutes.
                  action: notify.mobile_app_patricks_iphone
              else:
                - data:
                    title: Pool heater
                    message:
                      Turned off pool heater because importing power from grid for
                      {{ (((trigger.for.seconds) | int) / 60) | round(0) }} minutes.
                  action: notify.mobile_app_patricks_iphone
        - conditions:
            - condition: trigger
              id:
                - pump_off
          sequence:
            - data:
                title: Pool heater
                message: Turned off pool heater because pump just switched off.
              action: notify.mobile_app_patricks_iphone
  mode: single
- id: "1694562264439"
  alias: Notify - Consider turn OFF a/c as importing power
  description:
    A/C generally falls below 6kW within 1 hour, so notify if A/C is on
    and power above for more than 1 hour
  triggers:
    - trigger: numeric_state
      entity_id:
        - sensor.solarnet_power_grid
      for:
        hours: 1
        minutes: 0
        seconds: 0
      above: 6
  condition:
    - condition: or
      conditions:
        - condition: state
          entity_id: climate.ac
          state: cool
        - condition: state
          entity_id: climate.ac
          state: heat
  actions:
    - action: notify.mobile_app_patricks_iphone
      data:
        title: Air con - consider turning off
        message:
          Consider turning OFF air conditioner as now importing power {{ states('sensor.solarnet_power_grid')
          | float | round(1) }}kW for more than {{ (((trigger.for.seconds) | int) /
          60) | round(0) }} mins
  mode: single
- id: "1694750544303"
  alias: Notify - sump pump ON/OFF
  description: ""
  triggers:
    - trigger: numeric_state
      entity_id:
        - sensor.sump_pump_power
      above: 100
      id: power high
    - trigger: numeric_state
      entity_id:
        - sensor.sump_pump_power
      below: 10
      id: power low
  condition: []
  actions:
    - choose:
        - conditions:
            - condition: trigger
              id:
                - power high
          sequence:
            - data:
                title: Sump pump!
                message: Sump pump turned ON!
              action: notify.mobile_app_patricks_iphone
            - action: input_datetime.set_datetime
              metadata: {}
              data:
                datetime: "{{now().strftime('%Y-%m-%d %H:%M:%S') }}"
              target:
                entity_id: input_datetime.sump_pump_last_run
        - conditions:
            - condition: trigger
              id:
                - power low
          sequence:
            - data:
                title: Sump pump!
                message: Sump pump turned OFF!
              action: notify.mobile_app_patricks_iphone
  mode: single
- id: "1694818227771"
  alias: Blinds - CLOSE when sunny and hot (based on solar energy for the day at 10AM)
  description: ""
  triggers:
    - trigger: time
      at: "10:00:00"
  condition: []
  actions:
    - if:
        - condition: numeric_state
          entity_id: sensor.solarnet_energy_day
          above: 9.8
      then:
        - action: notify.mobile_app_patricks_iphone
          data:
            title: Closed blinds to reduce heat
            message:
              Closed rear blinds 1, and 3-5 as it's {{ trigger.now | as_timestamp
              | timestamp_custom('%I:%M %p') }} and solar energy for the day is above
              9.8kWh ({{ states('sensor.solarnet_energy_day') | float | round(1) }}kWh).
        - action: cover.close_cover
          data: {}
          target:
            entity_id:
              - cover.blind_3
              - cover.blind_4
              - cover.blind_5
      else:
        - action: notify.mobile_app_patricks_iphone
          data:
            title: Didn't close blinds
            message:
              Didn't close rear blinds as at {{ trigger.now | as_timestamp | timestamp_custom('%I:%M
              %p') }} because solar energy for the day was below 9.8kWh ({{ states('sensor.solarnet_energy_day')
              | float | round(1) }}kWh).
  mode: single
- id: "1694846476742"
  alias: Pool pump - ON at 8am
  description: ""
  triggers:
    - trigger: time
      at: 08:00:00
      id: trigger_time
  conditions:
    - condition: state
      entity_id: switch.pool_pump
      state: "off"
  actions:
    - action: switch.turn_on
      data: {}
      target:
        entity_id: switch.pool_pump
    - action: notify.mobile_app_patricks_iphone
      data:
        title: Pool pump turned ON
        message:
          Pool pump turned ON at {{ trigger.now | as_timestamp | timestamp_custom('%I:%M
          %p') }}
      enabled: false
  mode: single
- id: "1694847669808"
  alias: Pool pump - OFF at 5pm (Spring / Summer)
  description: ""
  triggers:
    - trigger: time
      at: "17:00:00"
      id: trigger_time
  conditions:
    - condition: state
      entity_id: climate.rostrevor_pool
      state: "off"
  actions:
    - action: switch.turn_off
      data: {}
      target:
        entity_id: switch.pool_pump
    - action: notify.mobile_app_patricks_iphone
      data:
        title: Pool pump turned OFF
        message:
          Pool pump turned OFF Spring/Summer at {{ trigger.now | as_timestamp
          | timestamp_custom('%I:%M %p') }}
      enabled: true
  mode: single
- id: "1695267626675"
  alias: "Blinds - open all (except #1) in the afternoon when sun < 25°"
  description: ""
  triggers:
    - trigger: numeric_state
      entity_id: sun.sun
      attribute: elevation
      below: 25
  condition: []
  actions:
    - action: cover.open_cover
      data: {}
      target:
        entity_id:
          - cover.blind_2
          - cover.blind_3
          - cover.blind_4
          - cover.blind_5
  mode: single
- id: "1695452208621"
  alias: Gate - close automatically after car passes through
  description: ""
  triggers:
    - trigger: state
      entity_id:
        - binary_sensor.driveway_light_beam
      to: "on"
      for:
        hours: 0
        minutes: 0
        seconds: 2
  condition:
    - condition: template
      value_template:
        "{{ as_timestamp(now()) - as_timestamp(states('input_datetime.garage_door_button_last_pressed'))
        < 5*60 }}"
  actions:
    - wait_for_trigger:
        - trigger: state
          entity_id:
            - binary_sensor.driveway_light_beam
          to: "off"
      timeout:
        hours: 0
        minutes: 5
        seconds: 0
        milliseconds: 0
    - delay:
        hours: 0
        minutes: 0
        seconds: 2
        milliseconds: 0
      enabled: true
    - action: cover.close_cover
      data: {}
      target:
        entity_id:
          - cover.driveway_gate
          - cover.garage_door
  mode: single
- id: "1696560418641"
  alias: Blinds - open blind 1 just before sunset
  description: ""
  triggers:
    - trigger: numeric_state
      entity_id:
        - sun.sun
      attribute: elevation
      below: 2.5
  conditions: []
  actions:
    - action: cover.open_cover
      data: {}
      target:
        entity_id:
          - cover.blind_1
  mode: single
- id: "1696932809329"
  alias: Blinds - close at 10:30AM if kitchen hot (>24C)
  description: ""
  triggers:
    - trigger: time
      at: "10:30:00"
  conditions:
    - condition: numeric_state
      entity_id: sensor.ac_kitchen_temperature
      above: 24
    - condition: numeric_state
      entity_id: sensor.solarnet_energy_day
      above: 9
  actions:
    - action: notify.mobile_app_patricks_iphone
      data:
        title: Closed blinds to reduce heat
        message:
          Closed rear blinds 1, and 3-5 as it's {{ trigger.now | as_timestamp
          | timestamp_custom('%I:%M %p') }} and kitchen temperature is above 22°C  ({{
          states_attr('sensor.ac_kitchen_temperature') | float | round(1) }}°C), solar
          energy for the day is above 9.0kWh ({{ states('sensor.solarnet_energy_day')
          | float | round(1) }}kWh)
    - action: cover.close_cover
      data: {}
      target:
        entity_id:
          - cover.blind_1
          - cover.blind_3
          - cover.blind_4
          - cover.blind_5
  mode: single
- id: "1697950024288"
  alias:
    Light - front hall lamp RED when front door / gate / garage open or unlocked
    15 mins
  description: ""
  triggers:
    - trigger: state
      entity_id:
        - lock.yale_smartlock_front_door
      to: unlocked
      for:
        hours: 0
        minutes: 15
        seconds: 0
      id: front door lock
    - trigger: state
      entity_id:
        - binary_sensor.front_door_aqara_contact
      to: "on"
      for:
        hours: 0
        minutes: 15
        seconds: 0
      id: front door
    - trigger: state
      entity_id:
        - cover.garage_door
      to: open
      for:
        hours: 0
        minutes: 15
        seconds: 0
      id: garage door
    - trigger: state
      entity_id:
        - cover.driveway_gate
      for:
        hours: 0
        minutes: 15
        seconds: 0
      to: open
      id: driveway gate
  condition: []
  actions:
    - choose:
        - conditions:
            - condition: trigger
              id:
                - front door lock
          sequence:
            - action: notify.mobile_app_patricks_iphone
              data:
                title: Security alert!
                message:
                  Front door has been unlocked for {{ (((trigger.for.seconds) | int)
                  / 60) | round(0) }} minutes. Will try and lock it now, but please double
                  check it.
                data:
                  push:
                    sound:
                      name: default
                      critical: 1
                      volume: 0.5
            - action: tts.cloud_say
              data:
                entity_id:
                  - media_player.back_lounge
                  - media_player.workshop_speaker
                message:
                  Front door has been unlocked for {{ (((trigger.for.seconds) | int)
                  / 60) | round(0) }} minutes. Will try and lock it now, but please double
                  check it.
            - action: lock.lock
              data: {}
              target:
                entity_id: lock.yale_smartlock_front_door
            - action: light.turn_on
              data:
                rgb_color:
                  - 255
                  - 0
                  - 0
                brightness_pct: 100
              target:
                entity_id: light.front_hall_lamp
        - conditions:
            - condition: trigger
              id:
                - front door
          sequence:
            - action: notify.mobile_app_patricks_iphone
              data:
                title: Security alert!
                message:
                  Front door has been open for {{ (((trigger.for.seconds) | int)
                  / 60) | round(0) }} minutes. Please go and close it.
                data:
                  push:
                    sound:
                      name: default
                      critical: 1
                      volume: 0.5
            - action: tts.cloud_say
              data:
                entity_id:
                  - media_player.back_lounge
                  - media_player.workshop_speaker
                message:
                  Front door has been open for {{ (((trigger.for.seconds) | int)
                  / 60) | round(0) }} minutes. Please go and close it.
            - action: light.turn_on
              data:
                rgb_color:
                  - 255
                  - 0
                  - 0
                brightness_pct: 100
              target:
                entity_id: light.front_hall_lamp
        - conditions:
            - condition: trigger
              id:
                - garage door
            - condition: state
              entity_id: input_boolean.garage_door_alerts
              state: "on"
          sequence:
            - action: notify.mobile_app_patricks_iphone
              data:
                title: Security alert!
                message:
                  Garage door has been open for {{ (((trigger.for.seconds) | int)
                  / 60) | round(0) }} minutes. Please go and close it.
                data:
                  push:
                    sound:
                      name: default
                      critical: 1
                      volume: 0.5
            - action: tts.cloud_say
              data:
                entity_id:
                  - media_player.back_lounge
                  - media_player.workshop_speaker
                message:
                  Garage door has been open for {{ (((trigger.for.seconds) | int)
                  / 60) | round(0) }} minutes. Please go and close it.
            - action: light.turn_on
              data:
                rgb_color:
                  - 255
                  - 0
                  - 0
                brightness_pct: 100
              target:
                entity_id: light.front_hall_lamp
        - conditions:
            - condition: trigger
              id:
                - driveway gate
            - condition: state
              entity_id: input_boolean.garage_door_alerts
              state: ""
          sequence:
            - action: notify.mobile_app_patricks_iphone
              data:
                title: Security alert!
                message:
                  Driveway gate has been open for {{ (((trigger.for.seconds) | int)
                  / 60) | round(0) }} minutes. Please go and close it.
                data:
                  push:
                    sound:
                      name: default
                      critical: 1
                      volume: 0.5
            - action: tts.cloud_say
              data:
                entity_id:
                  - media_player.back_lounge
                  - media_player.workshop_speaker
                message:
                  Driveway gate has been open for {{ (((trigger.for.seconds) | int)
                  / 60) | round(0) }} minutes. Please go and close it.
            - action: light.turn_on
              data:
                rgb_color:
                  - 255
                  - 0
                  - 0
                brightness_pct: 100
              target:
                entity_id: light.front_hall_lamp
  mode: single
- id: "1697960300615"
  alias: Light - front hall lamp REMOVE RED when front door / gate closed
  description: ""
  triggers:
    - trigger: state
      entity_id:
        - lock.yale_smartlock_front_door
      to: locked
      for:
        hours: 0
        minutes: 0
        seconds: 0
    - trigger: state
      entity_id:
        - binary_sensor.front_door_aqara_contact
      to: "off"
      for:
        hours: 0
        minutes: 0
        seconds: 0
    - trigger: state
      entity_id:
        - cover.garage_door
      to: closed
      for:
        hours: 0
        minutes: 0
        seconds: 0
    - trigger: state
      entity_id:
        - cover.driveway_gate
      to: closed
  conditions:
    - condition: template
      value_template: "{{ is_state_attr('light.front_hall_lamp' , 'rgb_color' ,
        (255, 0, 0)) }}"
    - condition: state
      entity_id: cover.garage_door
      state: closed
    - condition: state
      entity_id: cover.driveway_gate
      state: closed
  actions:
    - if:
        - condition: state
          entity_id: light.led_strip_front_hall_dimmer
          state: "on"
      then:
        - action: light.turn_on
          data:
            color_temp_kelvin: 358
            brightness_pct: 40
          target:
            entity_id: light.front_hall_lamp
      else:
        - action: light.turn_off
          data: {}
          target:
            entity_id: light.front_hall_lamp
  mode: single
- id: "1698533404217"
  alias: Motion - butlers pantry lights
  description: ""
  triggers:
    - trigger: state
      entity_id:
        - binary_sensor.everything_presence_lite_223508_occupancy
      to: "on"
      id: motion detected
    - trigger: state
      entity_id:
        - binary_sensor.everything_presence_lite_223508_occupancy
      to: "off"
      for:
        hours: 0
        minutes: 1
        seconds: 0
      enabled: true
    - trigger: state
      entity_id:
        - binary_sensor.everything_presence_lite_223508_occupancy
      to: "off"
      for:
        hours: 0
        minutes: 0
        seconds: 0
      enabled: false
  condition: []
  actions:
    - if:
        - condition: trigger
          id:
            - motion detected
      then:
        - if:
            - condition: state
              entity_id: input_boolean.sleep_mode
              state: "on"
          then:
            - action: light.turn_on
              data:
                brightness_pct: 2
              target:
                entity_id:
                  - light.led_strip_butlers_overhead_cupboards
          else:
            - action: light.turn_on
              data:
                brightness_pct: 50
              target:
                entity_id:
                  - light.butlers_downlight
                  - light.led_strip_butlers_overhead_cupboards
      else:
        - action: light.turn_off
          data: {}
          target:
            entity_id:
              - light.butlers_downlight
              - light.led_strip_butlers_overhead_cupboards
  mode: single
- id: "1698537751935"
  alias: Motion - Hallway turn lights
  description: ""
  triggers:
    - trigger: state
      entity_id:
        - binary_sensor.hallway_sensor_occupancy
      to: "on"
      id: motion detected
    - trigger: state
      entity_id:
        - binary_sensor.hallway_sensor_occupancy
      to: "off"
      for:
        hours: 0
        minutes: 2
        seconds: 40
      enabled: false
  condition:
    - condition: state
      entity_id: input_boolean.sleep_mode
      state: "on"
  actions:
    - if:
        - condition: trigger
          id:
            - motion detected
      then:
        - action: light.turn_on
          data:
            brightness_pct: 5
          target:
            entity_id: light.led_strip_kitchen_kicker
        - action: light.turn_on
          data:
            brightness_step_pct: 10
          target:
            entity_id: light.led_strip_front_hall_dimmer
      else:
        - action: light.turn_off
          data: {}
          target:
            entity_id:
              - light.led_strip_kitchen_kicker
              - light.led_strip_front_hall_dimmer
      enabled: false
    - action: light.turn_on
      data:
        brightness_pct: 10
      target:
        entity_id: light.led_strip_front_hall_dimmer
    - action: light.turn_on
      data:
        brightness_pct: 2
      target:
        entity_id: light.led_strip_kitchen_kicker
      enabled: false
    - delay:
        hours: 0
        minutes: 2
        seconds: 45
        milliseconds: 0
    - action: light.turn_off
      data: {}
      target:
        entity_id:
          - light.led_strip_kitchen_kicker
          - light.led_strip_front_hall_dimmer
  mode: single
- id: "1698538309359"
  alias: Motion - garage lights
  description: ""
  triggers:
    - trigger: state
      entity_id:
        - binary_sensor.garage_sensor_occupancy
      to: "on"
      id: motion detected
    - trigger: state
      entity_id:
        - cover.garage_door
      to: opening
      id: motion detected
    - trigger: state
      entity_id:
        - binary_sensor.garage_sensor_occupancy
      to: "off"
      for:
        hours: 0
        minutes: 7
        seconds: 0
    - trigger: state
      entity_id:
        - cover.garage_door
      to: closed
      for:
        hours: 0
        minutes: 7
        seconds: 0
  conditions: []
  actions:
    - if:
        - condition: and
          conditions:
            - condition: trigger
              id:
                - motion detected
            - condition: state
              entity_id: input_boolean.sleep_mode
              state: "off"
      then:
        - action: light.turn_on
          data: {}
          target:
            entity_id: light.garage_downlights
      else:
        - action: light.turn_off
          data: {}
          target:
            entity_id: light.garage_downlights
  mode: single
- id: "1699674375223"
  alias: Notify - leaving home
  description: ""
  triggers:
    - trigger: state
      entity_id:
        - device_tracker.patricks_iphone
      to: not_home
  conditions: []
  actions:
    - action: notify.mobile_app_patricks_iphone
      data:
        title: Left Home
        message: You just left Home zone
  mode: single
- id: "1701770661634"
  alias: Light - twinkly xmas lights random effect every 10 minutes
  description: ""
  triggers:
    - trigger: time_pattern
      minutes: /10
      enabled: false
    - trigger: numeric_state
      entity_id: sun.sun
      attribute: elevation
      below: 5
  conditions:
    - condition: numeric_state
      entity_id: sun.sun
      attribute: elevation
      below: 5
    - condition: state
      entity_id: input_boolean.sleep_mode
      state: "off"
  actions:
    - action: light.turn_on
      data:
        effect: "{{ range(0,10) | random | int }}"
      target:
        entity_id: light.twinkly_back_lounge
  mode: single
- id: "1701857008891"
  alias: Xmas - snow village ON at 8:30pm
  description: ""
  triggers:
    - trigger: time
      at: "20:30:00"
  condition: []
  actions:
    - action: light.turn_on
      target:
        entity_id:
          - light.xmas_village
        device_id: []
        area_id: []
      data: {}
  mode: single
- id: "1701857080434"
  alias: Xmas - snow village OFF at 9:00pm
  description: ""
  triggers:
    - trigger: time
      at: "21:00:00"
  condition: []
  actions:
    - action: light.turn_off
      data: {}
      target:
        entity_id: light.xmas_village
  mode: single
- id: "1701990925626"
  alias: Notify - eMTB charger
  description: ""
  triggers:
    - trigger: numeric_state
      entity_id:
        - sensor.emtb_charger_current_consumption
      id: start
      above: 5
    - trigger: numeric_state
      entity_id:
        - sensor.emtb_charger_current_consumption
      below: 10
      for:
        hours: 0
        minutes: 1
        seconds: 0
      id: finish
  condition: []
  actions:
    - choose:
        - conditions:
            - condition: trigger
              id:
                - start
          sequence:
            - action: notify.mobile_app_patricks_iphone
              data:
                title: eMTB charge started
                message:
                  Started eMTB charging ({{ now() | as_timestamp | timestamp_custom('%I:%M:%S
                  %p') }})
            - action: input_datetime.set_datetime
              target:
                entity_id: input_datetime.emtb_charge_start
              data:
                datetime: "{{ now().strftime('%Y-%m-%d %H:%M:%S') }}"
            - action: input_datetime.set_datetime
              target:
                entity_id: input_datetime.emtb_charge_finish
              data:
                datetime: "{{ now().strftime('%Y-%m-%d %H:%M:%S') }}"
        - conditions:
            - condition: trigger
              id:
                - finish
          sequence:
            - action: switch.turn_off
              target:
                entity_id: switch.emtb_charger
              data: {}
              enabled: true
            - action: input_datetime.set_datetime
              target:
                entity_id: input_datetime.emtb_charge_finish
              data:
                datetime: "{{ now().strftime('%Y-%m-%d %H:%M:%S') }}"
            - action: notify.mobile_app_patricks_iphone
              data:
                title: eMTB charge finished
                message:
                  Charge power has dropped below {{ trigger.below }}W for {{ (((trigger.for.seconds)
                  | int) / 60) | round(0) }} minutes, so turned OFF charger ({{ now() |
                  as_timestamp | timestamp_custom('%I:%M:%S %p') }}). Charge duration was
                  {{ (as_timestamp(states('input_datetime.emtb_charge_finish')) - as_timestamp(states('input_datetime.emtb_charge_start')))
                  | string | as_timedelta }}.
  mode: single
- id: "1702965547271"
  alias: Awtrix - pool temperature
  description: ""
  use_blueprint:
    path: smarthomejunkie/awtrix_create_sensor_app.yaml
    input:
      awtrix_displays:
        - 90c7f72628fd10fb50e521f03eab0814
      toggle_helper: input_boolean.awtrix_display_pool_temp
      my_sensor: input_number.pool_temperature_while_pump_on
      text_color:
        - 0
        - 157
        - 255
      duration: "0"
      scroll: true
      my_template_sensor:
        "{{ states('input_number.pool_temperature_while_pump_on')
        }} C"
      my_icon: "10497"
      push_icon: "0"
- id: "1702969140624"
  alias: Awtrix - global app cycle time
  description: ""
  use_blueprint:
    path: smarthomejunkie/awtrix_set_transition_time.yaml
    input:
      awtrix_displays:
        - 90c7f72628fd10fb50e521f03eab0814
      apptime_helper: input_number.awtrix_global_app_display_duration
- id: "1702969449628"
  alias: Awtrix - toggle date
  description: ""
  use_blueprint:
    path: smarthomejunkie/awtrix_toggle_stock_app.yaml
    input:
      awtrix_displays:
        - 90c7f72628fd10fb50e521f03eab0814
      stock_app: Date
      toggle_helper: input_boolean.awtrix_toggle_date
- id: "1702969567862"
  alias: Awtrix - toggle time
  description: ""
  use_blueprint:
    path: smarthomejunkie/awtrix_toggle_stock_app.yaml
    input:
      awtrix_displays:
        - 90c7f72628fd10fb50e521f03eab0814
      toggle_helper: input_boolean.awtrix_toggle_time
      stock_app: Time
- id: "1702969600588"
  alias: Awtrix - toggle temperature
  description: ""
  use_blueprint:
    path: smarthomejunkie/awtrix_toggle_stock_app.yaml
    input:
      awtrix_displays:
        - 90c7f72628fd10fb50e521f03eab0814
      toggle_helper: input_boolean.awtrix_toggle_temperature
      stock_app: Temperature
- id: "1702969619354"
  alias: Awtrix - toggle humidity
  description: ""
  use_blueprint:
    path: smarthomejunkie/awtrix_toggle_stock_app.yaml
    input:
      awtrix_displays:
        - 90c7f72628fd10fb50e521f03eab0814
      toggle_helper: input_boolean.awtrix_toggle_humidity
      stock_app: Humidity
- id: "1702969638508"
  alias: Awtrix - toggle battery
  description: ""
  use_blueprint:
    path: smarthomejunkie/awtrix_toggle_stock_app.yaml
    input:
      awtrix_displays:
        - 90c7f72628fd10fb50e521f03eab0814
      toggle_helper: input_boolean.awtrix_toggle_battery
      stock_app: Battery
- id: "1702983366732"
  alias: Awtrix - day solar
  description: ""
  use_blueprint:
    path: smarthomejunkie/awtrix_create_sensor_app.yaml
    input:
      awtrix_displays:
        - 90c7f72628fd10fb50e521f03eab0814
      toggle_helper: input_boolean.awtrix_toggle_day_solar_energy
      my_sensor: sensor.solarnet_energy_day
      text_color:
        - 255
        - 200
        - 0
      duration: "0"
      scroll: true
      my_template_sensor:
        Day {{ states('sensor.solarnet_energy_day')|float|round(1)
        }} kWh
      push_icon: "1"
      scrollspeed: 100
      my_icon: "1246"
      text_case: "2"
- id: "1702985039027"
  alias: Awtrix - real time import/export power
  description: ""
  use_blueprint:
    path: smarthomejunkie/awtrix_create_sensor_app.yaml
    input:
      awtrix_displays:
        - 90c7f72628fd10fb50e521f03eab0814
      toggle_helper: input_boolean.awtrix_toggle_import_export_power
      my_sensor: sensor.solarnet_power_grid
      use_threshold: true
      threshold_value: "0.0"
      low_value_text_color:
        - 0
        - 255
        - 0
      high_value_text_color:
        - 255
        - 0
        - 0
      scroll: false
      my_icon:
        "{% if states('sensor.solarnet_power_grid') | float < 0 %} 56656{%
        else %} 56657{% endif %}"
      display_abs_value: true
- id: "1703060969304"
  alias: Pool temperature - store value when pump on
  description:
    "Use an input_number to store estimated pool temperature. Pool temperature
    at heater inlet pipe is only accurate while pump in on (between 8am-5pm). After
    heater turns off, temperature drops at a rate of approx 2.0°C over 15 hours, but
    is falsely indicated as dropping much faster at the heater inlet pipe.

    Updates are slow, approx once per hour, hence in the morning, add an update at
    8:15am to allow pump to circulate water and let measured temp stabilise to correct
    / meaningful value."
  triggers:
    - trigger: state
      entity_id:
        - sensor.rostrevor_pool_inlet_water_temp_t02
    - trigger: time
      at: 08:15:00
  condition:
    - condition: state
      entity_id: switch.pool_pump
      state: "on"
      for:
        hours: 0
        minutes: 7
        seconds: 0
  actions:
    - action: input_number.set_value
      target:
        entity_id: input_number.pool_temperature_while_pump_on
      data:
        value:
          "{{ states('sensor.rostrevor_pool_inlet_water_temp_t02') | float(0)
          }}"
  mode: single
- id: "1703547741330"
  alias: Awtrix - back lounge temperature
  description: ""
  use_blueprint:
    path: smarthomejunkie/awtrix_create_sensor_app.yaml
    input:
      awtrix_displays:
        - 90c7f72628fd10fb50e521f03eab0814
      toggle_helper: input_boolean.awtrix_toggle_room_temperature
      my_sensor: sensor.ac_back_lounge_temperature
      my_icon: "2355"
      push_icon: "0"
      text_color:
        - 0
        - 255
        - 51
      scroll: false
- id: "1704841406186"
  alias: Backup to NAS
  description: Daily 6am backup to Synology NAS
  triggers:
    - trigger: time
      at: 06:00:00
  condition: []
  actions:
    - action: hassio.backup_full
      metadata: {}
      data:
        compressed: true
        homeassistant_exclude_database: false
        location: Synology_NAS
        name: Automated Daily Backup {{ now().strftime('%Y-%m-%d') }}
  mode: single
- id: "1704847078415"
  alias: Notify - Backps are stale
  description: ""
  triggers:
    - trigger: state
      entity_id:
        - binary_sensor.backups_stale
      from: "off"
      to: "on"
  condition: []
  actions:
    - action: notify.mobile_app_patricks_iphone
      metadata: {}
      data:
        title: Backups are Stale
        message:
          Please visit the 'Home Assistant Google Drive Backup ' add-on status
          page for details.
  mode: single
- id: "1705405175945"
  alias: Unlock front door when ped gate opens
  description: ""
  triggers:
    - trigger: state
      entity_id:
        - cover.pedestrian_gate
      to: open
  condition:
    - condition: or
      conditions:
        - condition: state
          entity_id: person.kathleen
          state: home
        - condition: state
          entity_id: person.patrick
          state: home
        - condition: state
          entity_id: person.jess
          state: home
    - condition: state
      entity_id: lock.yale_smartlock_front_door
      state: locked
  actions:
    - action: lock.unlock
      metadata: {}
      data: {}
      target:
        entity_id: lock.yale_smartlock_front_door
  mode: single
- id: "1706520388923"
  alias: Apple TV - dim lights on PLAY
  description: ""
  triggers:
    - trigger: state
      entity_id:
        - media_player.apple_tv_back_lounge
      to: playing
      id: playing
      for:
        hours: 0
        minutes: 0
        seconds: 0
    - trigger: state
      entity_id:
        - media_player.apple_tv_back_lounge
      to: paused
      id: paused
      for:
        hours: 0
        minutes: 0
        seconds: 0
    - trigger: state
      entity_id:
        - media_player.apple_tv_back_lounge
      to: "off"
      id: turned off
      enabled: true
    - trigger: state
      entity_id:
        - media_player.apple_tv_back_lounge
      to: standby
      id: standby
      enabled: true
    - trigger: state
      entity_id:
        - media_player.apple_tv_back_lounge
      to: idle
      id: idle
  condition:
    - condition: sun
      after: sunset
      before: sunrise
      enabled: true
    - condition: state
      entity_id: media_player.apple_tv_back_lounge
      attribute: media_content_type
      state: video
      enabled: false
  actions:
    - choose:
        - conditions:
            - condition: and
              conditions:
                - condition: numeric_state
                  entity_id: media_player.apple_tv_back_lounge
                  attribute: media_duration
                  above: 300
                - condition: trigger
                  id:
                    - playing
          sequence:
            - action: light.turn_off
              metadata: {}
              data: {}
              target:
                entity_id: light.back_lounge_pendant
            - action: light.turn_on
              metadata: {}
              data:
                brightness_pct: 12
                transition: 6
              target:
                entity_id: light.lamp_rhs_fireplace
        - conditions:
            - condition: trigger
              id:
                - paused
                - idle
          sequence:
            - action: light.turn_on
              target:
                entity_id:
                  - light.back_lounge_pendant
              data: {}
            - action: light.turn_on
              metadata: {}
              data:
                transition: 6
                brightness_pct: 50
              target:
                entity_id: light.lamp_rhs_fireplace
  mode: single
- id: "1707039891559"
  alias: Motion - WIR Lights
  description: ""
  triggers:
    - trigger: state
      entity_id:
        - binary_sensor.ld2410_esp32c3_b_presence
      to: "on"
      id: motion detected
      enabled: true
    - trigger: state
      entity_id:
        - binary_sensor.ld2410_esp32c3_b_presence
      to: "off"
      for:
        hours: 0
        minutes: 5
        seconds: 0
      enabled: true
    - trigger: state
      entity_id:
        - binary_sensor.wir_sensor_occupancy
      to: "on"
      id: motion detected
      enabled: true
    - trigger: state
      entity_id:
        - binary_sensor.wir_sensor_occupancy
      to: "off"
      for:
        hours: 0
        minutes: 3
        seconds: 0
      enabled: false
  conditions: []
  actions:
    - if:
        - condition: trigger
          id:
            - motion detected
      then:
        - if:
            - condition: state
              entity_id: input_boolean.sleep_mode
              state: "on"
          then:
            - action: light.turn_on
              metadata: {}
              data:
                brightness_pct: 24
              target:
                entity_id: light.led_strip_wir
          else:
            - action: light.turn_on
              data:
                brightness_pct: 100
              target:
                entity_id: light.wir_downlight
            - action: light.turn_on
              metadata: {}
              data:
                brightness_pct: 60
              target:
                entity_id: light.led_strip_wir
      else:
        - action: light.turn_off
          data:
            transition: 5
          target:
            entity_id:
              - light.wir_downlight
              - light.led_strip_wir
  mode: restart
- id: "1708818178334"
  alias: Notify - zigbee devices offline
  description: ""
  use_blueprint:
    path: Tahutipai/report_zigbee_zwave_devices_gone_offline.yaml
    input:
      actions:
        - action: notify.mobile_app_patricks_iphone
          metadata: {}
          data:
            title: Offline devices
            message: "{{ offline_devices }} is offline"
- id: "1709106061138"
  alias: Air con ON when HOT back lounge (nobody at home)
  description: ""
  triggers:
    - trigger: state
      entity_id:
        - sensor.ac_back_lounge_temperature
    - trigger: state
      entity_id:
        - sensor.solarnet_power_photovoltaics
  conditions:
    - condition: numeric_state
      entity_id: zone.home
      below: 1
      enabled: true
    - condition: state
      entity_id: climate.ac
      state: "off"
    - condition: numeric_state
      entity_id: sensor.ac_back_lounge_temperature
      above: 26
    - condition: numeric_state
      entity_id: sensor.solarnet_power_photovoltaics
      above: 5
  actions:
    - action: climate.turn_on
      data: {}
      target:
        entity_id:
          - climate.ac
          - climate.ac_entry
          - climate.ac_jess_br
          - climate.ac_master_br
          - climate.ac_spare_br
          - climate.ac_kitchen
          - climate.ac_back_lounge
          - climate.ac_workshop
    - action: climate.set_temperature
      data:
        temperature: 25
        hvac_mode: cool
      target:
        entity_id: climate.ac
    - action: climate.set_hvac_mode
      data:
        hvac_mode: cool
      target:
        entity_id: climate.ac
      enabled: true
    - action: climate.set_fan_mode
      data:
        fan_mode: medium
      target:
        entity_id: climate.ac
    - action: climate.set_temperature
      data:
        temperature: 25
        hvac_mode: cool
      target:
        entity_id:
          - climate.ac_entry
          - climate.ac_jess_br
          - climate.ac_master_br
          - climate.ac_spare_br
          - climate.ac_kitchen
          - climate.ac_back_lounge
          - climate.ac_workshop
    - action: climate.set_hvac_mode
      data:
        hvac_mode: "off"
      enabled: true
      target:
        entity_id:
          - climate.ac_front_lounge
          - climate.ac_spare_br
    - action: notify.mobile_app_patricks_iphone
      data:
        title: Air con ON (Nobody at home)
        message:
          Turned on air conditioner as Back Lounge temperature is above 26° and
          solar power more than 5kW ({{ states('sensor.solarnet_power_photovoltaics')
          | round(1) }} kW).
    - delay:
        hours: 0
        minutes: 0
        seconds: 15
        milliseconds: 0
  mode: single
- id: "1709935543205"
  alias: Air con ON when HOT back lounge (people at home)
  description: ""
  triggers:
    - trigger: time_pattern
      minutes: /10
  conditions:
    - condition: numeric_state
      entity_id: zone.home
      above: 0
    - condition: time
      after: 08:00:00
      before: "18:00:00"
    - condition: state
      entity_id: climate.ac
      state: "off"
    - condition: numeric_state
      entity_id: sensor.ac_back_lounge_temperature
      above: 25
  actions:
    - action: climate.turn_on
      data: {}
      target:
        entity_id:
          - climate.ac
          - climate.ac_entry
          - climate.ac_jess_br
          - climate.ac_master_br
          - climate.ac_spare_br
          - climate.ac_kitchen
          - climate.ac_back_lounge
          - climate.ac_workshop
    - action: climate.set_temperature
      data:
        temperature: 24
        hvac_mode: cool
      target:
        entity_id: climate.ac
    - action: climate.set_hvac_mode
      data:
        hvac_mode: cool
      target:
        entity_id: climate.ac
      enabled: true
    - action: climate.set_fan_mode
      data:
        fan_mode: medium
      target:
        entity_id: climate.ac
    - action: climate.set_temperature
      data:
        temperature: 24
        hvac_mode: cool
      target:
        entity_id:
          - climate.ac_entry
          - climate.ac_jess_br
          - climate.ac_master_br
          - climate.ac_spare_br
          - climate.ac_kitchen
          - climate.ac_back_lounge
          - climate.ac_workshop
    - action: climate.set_hvac_mode
      data:
        hvac_mode: "off"
      enabled: true
      target:
        entity_id:
          - climate.ac_front_lounge
          - climate.ac_spare_br
    - action: notify.mobile_app_patricks_iphone
      data:
        title: Air con turned on (People at home)
        message:
          Turned on air conditioner as Back Lounge temperature is above 25° and
          people are at home (i.e don't care if already importing power)
    - delay:
        hours: 0
        minutes: 0
        seconds: 15
        milliseconds: 0
  mode: single
- id: "1712976105136"
  alias: Pool pump - OFF at 12pm (Autumn / Winter)
  description: ""
  triggers:
    - trigger: time
      at: "12:00:00"
      id: trigger_time
  condition: []
  actions:
    - action: switch.turn_off
      data: {}
      target:
        entity_id: switch.pool_pump
    - action: notify.mobile_app_patricks_iphone
      data:
        title: Pool pump turned OFF
        message:
          Pool pump turned OFF Autumn/Winter at {{ trigger.now | as_timestamp
          | timestamp_custom('%I:%M %p') }}
      enabled: true
  mode: single
- id: "1713615252706"
  alias: Shelly Overheating Alert
  description: Trigger an alert if any sensor ending with '_overheating' is triggered
  triggers:
    - trigger: template
      value_template:
        "{% set ns = namespace(found=false) %}\n{% for state in states.binary_sensor
        %}\n  {% if state.entity_id.endswith('_overheating') and state.state == 'on'
        %}\n    {% set ns.found = true %}\n  {% endif %}\n{% endfor %}\n{{ ns.found
        }}"
  condition: []
  actions:
    - action: notify.mobile_app_patricks_iphone
      data:
        title: "⚠️ Shelly Overheating \U0001F525"
        message:
          "{% if trigger %}\n  {{ trigger.to_state.attributes.friendly_name }}\n{%
          else %}\n  Check the system for more details.\n{% endif %}\n"
  mode: single
- id: "1720908527024"
  alias: Sleep mode on and off at time of day
  description: ""
  triggers:
    - trigger: time
      at: input_datetime.sleep_start
      id: sleep on
    - trigger: time
      id: sleep off
      at: input_datetime.sleep_off
  condition: []
  actions:
    - choose:
        - conditions:
            - condition: trigger
              id:
                - sleep on
          sequence:
            - action: input_boolean.turn_on
              metadata: {}
              data: {}
              target:
                entity_id: input_boolean.sleep_mode
        - conditions:
            - condition: trigger
              id:
                - sleep off
          sequence:
            - action: input_boolean.turn_off
              target:
                entity_id:
                  - input_boolean.sleep_mode
              data: {}
  mode: single
- id: "1722746030498"
  alias: Notify - Low Battery Notifications & Actions
  description: ""
  use_blueprint:
    path: Blackshome/low-battery-notifications-and-actions.yaml
    input:
      include_button: enable_button_trigger
      button_entity: input_button.check_for_low_batteries
      include_time: time_enabled
      time: "10:15:00"
      sensor_selection: enable_all_sensors
      include_easy_notify: enable_easy_okay_notify
      notify_device:
        - 0f5265246071d1e781aadc2b8aaea0c8
      include_persistent_notification: disabled_persistent_notification
- id: "1724062016510"
  alias: Courtyard camera person
  description: From Unifi Protect webhook
  triggers:
    - trigger: webhook
      allowed_methods:
        - POST
      local_only: true
      webhook_id: aB3$eFg7!hIj9KlMn0PqRsTuVwX
      enabled: false
    - trigger: state
      entity_id:
        - binary_sensor.courtyard_person_detected
      to: "on"
  conditions: []
  actions:
    - action: notify.mobile_app_patricks_iphone
      metadata: {}
      data:
        title: Unifi CCTV Camera
        message:
          "Courtyard: {% set triggers = trigger.json.alarm.triggers %} {% for
          trigger in triggers -%}\n  {{ trigger.key }}\n{% endfor %}\n"
      enabled: false
    - action: input_boolean.turn_on
      metadata: {}
      data: {}
      target:
        entity_id: input_boolean.courtyard_camera_person
    - delay:
        hours: 0
        minutes: 0
        seconds: 10
        milliseconds: 0
    - action: input_boolean.turn_off
      target:
        entity_id:
          - input_boolean.courtyard_camera_person
      data: {}
  mode: single
- id: "1726141404103"
  alias: Back Yard Camera Person
  description: From Unifi Protect webhook
  triggers:
    - trigger: webhook
      allowed_methods:
        - POST
      local_only: true
      webhook_id: OvyU3vgPH2l9AgSdTJVeZmASf0t
      enabled: false
    - trigger: state
      entity_id:
        - binary_sensor.back_yard_person_detected
      to: "on"
  conditions: []
  actions:
    - action: notify.mobile_app_patricks_iphone
      metadata: {}
      data:
        title: Unifi CCTV Camera
        message:
          "Back Yard: {% set triggers = trigger.json.alarm.triggers %} {% for
          trigger in triggers -%}\n  {{ trigger.key }}\n{% endfor %}\n"
      enabled: false
    - action: input_boolean.turn_on
      metadata: {}
      data: {}
      target:
        entity_id: input_boolean.back_yard_camera_person
    - delay:
        hours: 0
        minutes: 0
        seconds: 10
        milliseconds: 0
    - action: input_boolean.turn_off
      target:
        entity_id:
          - input_boolean.back_yard_camera_person
      data: {}
  mode: single
- id: "1726141806764"
  alias: Driveway Camera Person
  description: From Unifi Protect webhook
  triggers:
    - trigger: webhook
      allowed_methods:
        - POST
      local_only: true
      webhook_id: 5fGh6IjK7!lMn8OpQr9StUvWxY
      enabled: false
    - trigger: state
      entity_id:
        - binary_sensor.driveway_person_detected
      to: "on"
  conditions: []
  actions:
    - action: notify.mobile_app_patricks_iphone
      metadata: {}
      data:
        title: Unifi CCTV Camera
        message:
          "Driveway: {% set triggers = trigger.json.alarm.triggers %} {% for
          trigger in triggers -%}\n  {{ trigger.key }}\n{% endfor %}\n"
      enabled: false
    - action: input_boolean.turn_on
      metadata: {}
      data: {}
      target:
        entity_id: input_boolean.driveway_camera_person
    - delay:
        hours: 0
        minutes: 0
        seconds: 10
        milliseconds: 0
    - action: input_boolean.turn_off
      data: {}
      target:
        entity_id: input_boolean.driveway_camera_person
  mode: single
- id: "1726142105464"
  alias: Front Yard Camera Person
  description: From Unifi Protect webhook
  triggers:
    - trigger: webhook
      allowed_methods:
        - POST
      local_only: true
      webhook_id: hfjdkhafulsrhyugjffhguryt78645wo
      enabled: false
    - trigger: state
      entity_id:
        - binary_sensor.front_yard_person_detected
      to: "on"
  conditions: []
  actions:
    - action: notify.mobile_app_patricks_iphone
      metadata: {}
      data:
        title: Unifi CCTV Camera
        message:
          "Front Yard: {% set triggers = trigger.json.alarm.triggers %} {% for
          trigger in triggers -%}\n  {{ trigger.key }}\n{% endfor %}\n"
      enabled: false
    - action: input_boolean.turn_on
      metadata: {}
      data: {}
      target:
        entity_id: input_boolean.front_yard_camera_person
    - delay:
        hours: 0
        minutes: 0
        seconds: 10
        milliseconds: 0
    - action: input_boolean.turn_off
      data: {}
      target:
        entity_id: input_boolean.front_yard_camera_person
  mode: single
- id: "1726142223544"
  alias: Pool and Alfresco Camera Person
  description: From Unifi Protect webhook
  triggers:
    - trigger: webhook
      allowed_methods:
        - POST
      local_only: true
      webhook_id: -_8MpGAtC7VoBX2m9aa90vbY5
      enabled: false
    - trigger: state
      entity_id:
        - binary_sensor.pool_and_alfresco_person_detected
      to: "on"
  conditions: []
  actions:
    - action: notify.mobile_app_patricks_iphone
      metadata: {}
      data:
        title: Unifi CCTV Camera
        message:
          "Pool and Alfresco: {% set triggers = trigger.json.alarm.triggers %}
          {% for trigger in triggers -%}\n  {{ trigger.key }}\n{% endfor %}\n"
      enabled: false
    - action: input_boolean.turn_on
      metadata: {}
      data: {}
      target:
        entity_id: input_boolean.pool_alfresco_camera_person
    - delay:
        hours: 0
        minutes: 0
        seconds: 10
        milliseconds: 0
    - action: input_boolean.turn_off
      data: {}
      target:
        entity_id: input_boolean.pool_alfresco_camera_person
  mode: single
- id: "1726349053457"
  alias: Sleep mode off if alfresco door opens after 4:30am
  description: ""
  triggers:
    - trigger: state
      entity_id:
        - binary_sensor.alfresco_door_contact
      to: "on"
  condition:
    - condition: time
      after: 04:30:00
      before: 09:00:00
  actions:
    - action: input_boolean.turn_off
      metadata: {}
      data: {}
      target:
        entity_id: input_boolean.sleep_mode
  mode: single
- id: "1726959314317"
  alias: Rack Fans - set low speed at night or sleep
  description: ""
  triggers:
    - trigger: state
      entity_id:
        - input_boolean.sleep_mode
      to: "on"
      id: sleep
  condition:
    - condition: template
      value_template: "{{ state_attr('fan.pwm_fanctrl_fan1_speed', 'percentage')
        > 30 }}"
  actions:
    - action: switch.turn_off
      metadata: {}
      data: {}
      target:
        entity_id: switch.pwm_fanctrl_fan_auto_mode
    - action: input_boolean.turn_on
      metadata: {}
      data: {}
      target:
        entity_id: input_boolean.rack_fans_auto_mode_turned_off_at_sleep
    - action: fan.set_percentage
      metadata: {}
      data:
        percentage: 20
      target:
        entity_id:
          - fan.pwm_fanctrl_fan1_speed
          - fan.pwm_fanctrl_fan2_speed
          - fan.pwm_fanctrl_fan3_speed
          - fan.pwm_fanctrl_fan4_speed
  mode: single
- id: "1727000617515"
  alias: Rack fans - enable auto mode in morning
  description:
    Re-enable rack fan auto mode if was turned off the night before during
    sleep and fans were too fast (noisy)
  triggers:
    - at: 06:30:00
      trigger: time
  conditions:
    - condition: state
      entity_id: switch.pwm_fanctrl_fan_auto_mode
      state: "off"
    - condition: state
      entity_id: input_boolean.rack_fans_auto_mode_turned_off_at_sleep
      state: "on"
  actions:
    - action: switch.turn_on
      target:
        entity_id:
          - switch.pwm_fanctrl_fan_auto_mode
      data: {}
    - action: input_boolean.turn_off
      metadata: {}
      data: {}
      target:
        entity_id: input_boolean.rack_fans_auto_mode_turned_off_at_sleep
  mode: single
- id: "1727092853512"
  alias: Notify - Harvey Roller door left open
  description: ""
  triggers:
    - trigger: state
      entity_id:
        - binary_sensor.small_roller_door_contact
      to: "on"
      for:
        hours: 0
        minutes: 15
        seconds: 0
  condition: []
  actions:
    - action: notify.patrick_and_kathleen
      metadata: {}
      data:
        title: Harvey Roller Door
        message:
          Left open for {{ (((trigger.for.seconds) | int) / 60) | round(0) }}
          minutes, be careful!
        data:
          push:
            sound:
              name: default
              critical: 1
              volume: 0.3
  mode: single
- id: "1727693357170"
  alias: Decrement Irrigation Rain Delay
  description:
    Decrements the irrigation rain delay each day and enables irrigation
    when delay reaches zero.
  triggers:
    - trigger: time
      at: 00:00:00
  conditions:
    - condition: numeric_state
      entity_id: input_number.irrigation_rain_delay
      above: 0
  actions:
    - action: input_number.decrement
      metadata: {}
      data: {}
      target:
        entity_id: input_number.irrigation_rain_delay
  mode: single
- id: "1728161381884"
  alias: Irrigation - rain delay silder turn enable boolean ON or OFF
  description: ""
  triggers:
    - trigger: state
      entity_id:
        - input_number.irrigation_rain_delay
  conditions: []
  actions:
    - choose:
        - conditions:
            - condition: numeric_state
              entity_id: input_number.irrigation_rain_delay
              above: 0
          sequence:
            - action: switch.turn_off
              metadata: {}
              data: {}
              target:
                entity_id:
                  - switch.enable_program
                  - switch.enable_program_2
                  - switch.enable_program_3
        - conditions:
            - condition: numeric_state
              entity_id: input_number.irrigation_rain_delay
              below: 1
          sequence:
            - action: switch.turn_on
              metadata: {}
              data: {}
              target:
                entity_id:
                  - switch.enable_program
                  - switch.enable_program_2
                  - switch.enable_program_3
            - action: notify.mobile_app_patricks_iphone
              data:
                title: "Irrigation \U0001F4A6"
                message: Rain delay ended, irrigation is enabled
  mode: single
- id: "1730060540153"
  alias: Speaker say - back lawn sprinklers on soon
  description: ""
  triggers:
    - value_template:
        "{{ (as_timestamp(states('sensor.next_run')) | timestamp_custom('%Y-%m-%d
        %H:%M:%S', true) \n      == (now() + timedelta(hours=0, minutes=5)).strftime('%Y-%m-%d
        %H:%M:%S') ) }}"
      trigger: template
      id: first warning
    - value_template:
        "{{ (as_timestamp(states('sensor.next_run')) | timestamp_custom('%Y-%m-%d
        %H:%M:%S', true) \n      == (now() + timedelta(hours=0, minutes=2)).strftime('%Y-%m-%d
        %H:%M:%S') ) }}"
      trigger: template
      id: second warning
    - trigger: state
      entity_id:
        - switch.back_lawns_program
      to: "on"
      id: on now
    - trigger: state
      entity_id:
        - switch.back_lawns_program
      to: "off"
      id: finished
  conditions:
    - condition: numeric_state
      entity_id: input_number.irrigation_rain_delay
      below: 1
  actions:
    - choose:
        - conditions:
            - condition: trigger
              id:
                - first warning
          sequence:
            - action: tts.cloud_say
              data:
                message: Back lawn sprinkler on in five minutes!
                entity_id: media_player.back_lounge_speaker
        - conditions:
            - condition: trigger
              id:
                - second warning
          sequence:
            - action: tts.cloud_say
              data:
                entity_id: media_player.back_lounge_speaker
                message: Back lawn sprinkler on in two minutes!
        - conditions:
            - condition: trigger
              id:
                - on now
          sequence:
            - action: tts.cloud_say
              data:
                entity_id: media_player.back_lounge_speaker
                message: Back lawn sprinklers on NOW!
            - action: light.turn_on
              metadata: {}
              data:
                brightness_pct: 100
                color_name: green
              target:
                entity_id: light.back_lounge_sideboard_lamp
        - conditions:
            - condition: trigger
              id:
                - finished
          sequence:
            - action: tts.cloud_say
              data:
                entity_id: media_player.back_lounge_speaker
                message: Back lawn sprinklers finished
            - if:
                - condition: numeric_state
                  entity_id: sun.sun
                  attribute: elevation
                  below: 5
              then:
                - action: light.turn_on
                  metadata: {}
                  data:
                    color_temp_kelvin: 2900
                    brightness_pct: 35
                  target:
                    entity_id: light.back_lounge_sideboard_lamp
              else:
                - action: light.turn_off
                  metadata: {}
                  target:
                    entity_id: light.back_lounge_sideboard_lamp
                  data: {}
  mode: single
- id: "1730458549995"
  alias: Hall lamp RED when garge or gate open
  description: ""
  triggers:
    - trigger: state
      entity_id:
        - cover.garage_door
      to: open
      for:
        hours: 0
        minutes: 0
        seconds: 0
      id: garage door
    - trigger: state
      entity_id:
        - cover.driveway_gate
      for:
        hours: 0
        minutes: 0
        seconds: 0
      to: opening
      id: driveway gate
    - trigger: state
      entity_id:
        - cover.garage_door
      to: open
      for:
        hours: 0
        minutes: 0
        seconds: 0
      id: garage door
    - trigger: state
      entity_id:
        - cover.garage_door
      to: opening
      for:
        hours: 0
        minutes: 0
        seconds: 0
      id: garage door
  conditions: []
  actions:
    - action: light.turn_on
      data:
        rgb_color:
          - 255
          - 0
          - 0
        brightness_pct: 100
      target:
        entity_id: light.front_hall_lamp
  mode: single
- id: "1735957878118"
  alias: Button - workshop
  description: ""
  triggers:
    - domain: mqtt
      device_id: 656b55c99717ed704e669e0d521be10f
      type: action
      subtype: single
      trigger: device
      id: trigger single
    - domain: mqtt
      device_id: 656b55c99717ed704e669e0d521be10f
      type: action
      subtype: double
      trigger: device
      id: trigger double
    - domain: mqtt
      device_id: 656b55c99717ed704e669e0d521be10f
      type: action
      subtype: hold
      trigger: device
      id: trigger hold
  conditions: []
  actions:
    - choose:
        - conditions:
            - condition: trigger
              id:
                - trigger single
          sequence:
            - action: switch.toggle
              metadata: {}
              data: {}
              target:
                entity_id: switch.workshop_power_strip
        - conditions:
            - condition: trigger
              id:
                - trigger double
          sequence:
            - action: light.toggle
              metadata: {}
              data: {}
              target:
                entity_id: light.led_strip_workshop_shelf_dimmer
        - conditions:
            - condition: trigger
              id:
                - trigger hold
          sequence:
            - action: light.turn_off
              metadata: {}
              data: {}
              target:
                area_id: electronics_lab
  mode: single
- id: "1735959432396"
  alias: Button garage
  description: ""
  triggers:
    - domain: mqtt
      device_id: ad7e33ba164f20aa9d1d7fcabfdf2196
      type: action
      subtype: single
      trigger: device
      id: trigger single
    - domain: mqtt
      device_id: ad7e33ba164f20aa9d1d7fcabfdf2196
      type: action
      subtype: double
      trigger: device
      id: trigger double
    - domain: mqtt
      device_id: ad7e33ba164f20aa9d1d7fcabfdf2196
      type: action
      subtype: hold
      trigger: device
      id: trigger hold
  conditions: []
  actions:
    - choose:
        - conditions:
            - condition: trigger
              id:
                - trigger single
          sequence:
            - action: cover.open_cover
              data: {}
              target:
                entity_id:
                  - cover.garage_door
                  - cover.driveway_gate
            - action: input_datetime.set_datetime
              metadata: {}
              data:
                datetime: "{{ now().strftime('%Y-%m-%d %H:%M:%S') }}"
              target:
                entity_id: input_datetime.garage_door_button_last_pressed
        - conditions:
            - condition: trigger
              id:
                - trigger double
          sequence:
            - action: cover.toggle
              metadata: {}
              data: {}
              target:
                entity_id: cover.driveway_gate
        - conditions:
            - condition: trigger
              id:
                - trigger hold
          sequence:
            - action: cover.close_cover
              data: {}
              target:
                entity_id:
                  - cover.driveway_gate
                  - cover.garage_door
  mode: single
- id: "1735960974497"
  alias: Button Patrick bedside
  description: ""
  triggers:
    - domain: mqtt
      device_id: 0677bec4f0eb2446fa3216dd66782823
      type: action
      subtype: single
      trigger: device
      id: trigger single
    - domain: mqtt
      device_id: 0677bec4f0eb2446fa3216dd66782823
      type: action
      subtype: double
      trigger: device
      id: trigger double
    - domain: mqtt
      device_id: 0677bec4f0eb2446fa3216dd66782823
      type: action
      subtype: hold
      trigger: device
      id: trigger hold
  conditions: []
  actions:
    - choose:
        - conditions:
            - condition: trigger
              id:
                - trigger single
          sequence:
            - action: light.toggle
              metadata: {}
              data:
                brightness_pct: 7
              target:
                entity_id:
                  - light.bedside_lamp_kathleen
        - conditions:
            - condition: trigger
              id:
                - trigger double
          sequence:
            - action: light.turn_on
              metadata: {}
              data: {}
              target:
                entity_id:
                  - light.front_yard_lights
                  - light.back_yard_lights
                  - light.courtyard_flood_light
        - conditions:
            - condition: trigger
              id:
                - trigger hold
          sequence:
            - action: light.turn_off
              target:
                entity_id: light.all_lights
              data: {}
            - if:
                - condition: state
                  entity_id: binary_sensor.workshop_window_contact
                  state: "on"
              then:
                - action: notify.mobile_app_patricks_iphone
                  data:
                    message: Workshop window is open
                    title: Window open
            - if:
                - condition: state
                  entity_id: binary_sensor.alfresco_door_contact
                  state: "on"
              then:
                - action: notify.mobile_app_patricks_iphone
                  data:
                    message: Alfresco door is open
                    title: Door open
            - if:
                - condition: state
                  entity_id: binary_sensor.front_door_aqara_contact
                  state: "on"
              then:
                - action: notify.mobile_app_patricks_iphone
                  data:
                    message: Front door is open
                    title: Door open
            - if:
                - condition: time
                  after: "21:00:00"
                  before: 06:00:00
              then:
                - action: input_boolean.turn_on
                  data: {}
                  target:
                    entity_id: input_boolean.sleep_mode
                - action: notify.mobile_app_patricks_iphone
                  data:
                    message: Sleep mode turned on with long press of Patrick's bedside button
                    title: Sleep mode ON
            - if:
                - condition: state
                  state: "on"
                  entity_id: binary_sensor.small_roller_door_contact
              then:
                - action: notify.mobile_app_patricks_iphone
                  data:
                    message: Harvey roller door is open
                    title: Harvey roller door
            - action: switch.turn_off
              target:
                entity_id: switch.gas_heater
              data: {}
            - action: switch.turn_off
              data: {}
              target:
                entity_id: switch.pool_pump
            - action: fan.turn_off
              metadata: {}
              data: {}
              target:
                entity_id:
                  - fan.pwm_fanctrl_fan1_speed
                  - fan.pwm_fanctrl_fan2_speed
                  - fan.pwm_fanctrl_fan3_speed
                  - fan.pwm_fanctrl_fan4_speed
  mode: single
- id: "1735962895487"
  alias: Button Kathleen bedside
  description: ""
  triggers:
    - domain: mqtt
      device_id: 91bb27cb2c42260c94f57d1e70f26ed4
      type: action
      subtype: single
      trigger: device
      id: trigger single
    - domain: mqtt
      device_id: 91bb27cb2c42260c94f57d1e70f26ed4
      type: action
      subtype: double
      trigger: device
      id: trigger double
    - domain: mqtt
      device_id: 91bb27cb2c42260c94f57d1e70f26ed4
      type: action
      subtype: hold
      trigger: device
      id: trigger hold
  conditions: []
  actions:
    - choose:
        - conditions:
            - condition: trigger
              id:
                - trigger single
          sequence:
            - action: light.toggle
              metadata: {}
              data:
                brightness_pct: 7
              target:
                entity_id: light.bedside_lamp_kathleen
        - conditions:
            - condition: trigger
              id:
                - trigger double
          sequence:
            - action: light.turn_on
              metadata: {}
              data: {}
              target:
                entity_id:
                  - light.front_yard_lights
                  - light.back_yard_lights
                  - light.courtyard_flood_light
        - conditions:
            - condition: trigger
              id:
                - trigger hold
          sequence:
            - action: light.turn_off
              target:
                entity_id: light.all_lights
              data: {}
            - if:
                - condition: state
                  entity_id: binary_sensor.workshop_window_contact
                  state: "on"
              then:
                - action: notify.mobile_app_patricks_iphone
                  data:
                    message: Workshop window is open
                    title: Window open
            - if:
                - condition: state
                  entity_id: binary_sensor.alfresco_door_contact
                  state: "on"
              then:
                - action: notify.mobile_app_patricks_iphone
                  data:
                    message: Alfresco door is open
                    title: Door open
            - if:
                - condition: state
                  entity_id: binary_sensor.front_door_aqara_contact
                  state: "on"
              then:
                - action: notify.mobile_app_patricks_iphone
                  data:
                    message: Front door is open
                    title: Door open
            - if:
                - condition: time
                  after: "21:00:00"
                  before: 06:00:00
              then:
                - action: input_boolean.turn_on
                  data: {}
                  target:
                    entity_id: input_boolean.sleep_mode
                - action: notify.mobile_app_patricks_iphone
                  data:
                    message: Sleep mode turned on with long press of Kathleen's bedside button
                    title: Sleep mode ON
            - if:
                - condition: state
                  state: "on"
                  entity_id: binary_sensor.small_roller_door_contact
              then:
                - action: notify.mobile_app_patricks_iphone
                  data:
                    message: Harvey roller door is open
                    title: Harvey roller door
            - action: switch.turn_off
              target:
                entity_id: switch.gas_heater
              data: {}
            - action: switch.turn_off
              data: {}
              target:
                entity_id: switch.pool_pump
            - action: fan.turn_off
              metadata: {}
              data: {}
              target:
                entity_id:
                  - fan.pwm_fanctrl_fan1_speed
                  - fan.pwm_fanctrl_fan2_speed
                  - fan.pwm_fanctrl_fan3_speed
                  - fan.pwm_fanctrl_fan4_speed
  mode: single
- id: "1735962959543"
  alias: Button Jess bedside
  description: ""
  triggers:
    - domain: mqtt
      device_id: f0fff143a53273caf42a95d9216f2f0d
      type: action
      subtype: single
      trigger: device
      id: trigger single
    - domain: mqtt
      device_id: f0fff143a53273caf42a95d9216f2f0d
      type: action
      subtype: double
      trigger: device
      id: trigger double
    - domain: mqtt
      device_id: f0fff143a53273caf42a95d9216f2f0d
      type: action
      subtype: hold
      trigger: device
      id: trigger hold
  conditions: []
  actions:
    - choose:
        - conditions:
            - condition: trigger
              id:
                - trigger single
          sequence:
            - action: light.toggle
              metadata: {}
              data:
                brightness_pct: 7
              target:
                entity_id: light.led_strip_kitchen_kicker
        - conditions:
            - condition: trigger
              id:
                - trigger double
          sequence:
            - action: light.turn_on
              metadata: {}
              data: {}
              target:
                entity_id:
                  - light.front_yard_lights
                  - light.back_yard_lights
                  - light.courtyard_flood_light
        - conditions:
            - condition: trigger
              id:
                - trigger hold
          sequence:
            - action: light.turn_off
              target:
                entity_id: light.all_lights
              data: {}
            - if:
                - condition: state
                  entity_id: binary_sensor.workshop_window_contact
                  state: "on"
              then:
                - action: notify.mobile_app_patricks_iphone
                  data:
                    message: Workshop window is open
                    title: Window open
            - if:
                - condition: state
                  entity_id: binary_sensor.alfresco_door_contact
                  state: "on"
              then:
                - action: notify.mobile_app_patricks_iphone
                  data:
                    message: Alfresco door is open
                    title: Door open
            - if:
                - condition: state
                  entity_id: binary_sensor.front_door_aqara_contact
                  state: "on"
              then:
                - action: notify.mobile_app_patricks_iphone
                  data:
                    message: Front door is open
                    title: Door open
            - if:
                - condition: time
                  after: "21:00:00"
                  before: 06:00:00
              then:
                - action: input_boolean.turn_on
                  data: {}
                  target:
                    entity_id: input_boolean.sleep_mode
                - action: notify.mobile_app_patricks_iphone
                  data:
                    message: Sleep mode turned on with long press of Patrick's bedside button
                    title: Sleep mode ON
            - if:
                - condition: state
                  state: "on"
                  entity_id: binary_sensor.small_roller_door_contact
              then:
                - action: notify.mobile_app_patricks_iphone
                  data:
                    message: Harvey roller door is open
                    title: Harvey roller door
            - action: switch.turn_off
              target:
                entity_id: switch.gas_heater
              data: {}
            - action: switch.turn_off
              data: {}
              target:
                entity_id: switch.pool_pump
            - action: fan.turn_off
              metadata: {}
              data: {}
              target:
                entity_id:
                  - fan.pwm_fanctrl_fan1_speed
                  - fan.pwm_fanctrl_fan2_speed
                  - fan.pwm_fanctrl_fan3_speed
                  - fan.pwm_fanctrl_fan4_speed
  mode: single
- id: "1735964177692"
  alias: Button washing machine
  description: ""
  triggers:
    - domain: mqtt
      device_id: 0d699650342d3324d899009224eec05d
      type: action
      subtype: single
      trigger: device
      id: trigger single
    - domain: mqtt
      device_id: 0d699650342d3324d899009224eec05d
      type: action
      subtype: double
      trigger: device
      id: trigger double
    - domain: mqtt
      device_id: 0d699650342d3324d899009224eec05d
      type: action
      subtype: hold
      trigger: device
      id: trigger hold
  conditions: []
  actions:
    - choose:
        - conditions:
            - condition: trigger
              id:
                - trigger single
          sequence:
            - if:
                - condition: or
                  conditions:
                    - condition: numeric_state
                      entity_id: sun.sun
                      attribute: elevation
                      above: 5
                    - condition: state
                      entity_id: input_boolean.sleep_mode
                      state: "on"
              then:
                - action: light.turn_off
                  data: {}
                  target:
                    entity_id: light.back_lounge_sideboard_lamp
              else:
                - if: []
                  then:
                    - action: light.turn_on
                      data:
                        brightness_pct: 35
                        color_temp_kelvin: 2900
                      target:
                        entity_id: light.back_lounge_sideboard_lamp
        - conditions:
            - condition: trigger
              id:
                - trigger double
          sequence:
            - action: light.toggle
              metadata: {}
              data: {}
              target:
                entity_id:
                  - light.laundry_bunker_light
                  - light.laundry_downlight
  mode: single
- id: "1735965624928"
  alias: Button hall stand
  description: ""
  triggers:
    - domain: mqtt
      device_id: f1eccd15be4815075fcd5ae5d98d4b22
      type: action
      subtype: single
      trigger: device
      id: trigger single
    - domain: mqtt
      device_id: f1eccd15be4815075fcd5ae5d98d4b22
      type: action
      subtype: double
      trigger: device
      id: trigger double
    - domain: mqtt
      device_id: f1eccd15be4815075fcd5ae5d98d4b22
      type: action
      subtype: hold
      trigger: device
      id: trigger hold
  conditions: []
  actions:
    - choose:
        - conditions:
            - condition: trigger
              id:
                - trigger single
          sequence:
            - action: cover.open_cover
              metadata: {}
              data: {}
              target:
                entity_id: cover.pedestrian_gate
          alias: Open ped gate
        - conditions:
            - condition: trigger
              id:
                - trigger double
          sequence:
            - action: light.toggle
              metadata: {}
              data:
                effect: Warm White
              target:
                entity_id: light.front_hall_lamp
          alias: Toggle front hall lamp
        - conditions:
            - condition: trigger
              id:
                - trigger hold
          sequence:
            - action: light.toggle
              metadata: {}
              data: {}
              target:
                entity_id: light.front_yard_lights
          alias: Toggle front yard lights
  mode: single
- id: "1737950486072"
  alias: Awtrix - pool pump
  description: ""
  use_blueprint:
    path: smarthomejunkie/awtrix_create_sensor_app.yaml
    input:
      awtrix_displays:
        - 90c7f72628fd10fb50e521f03eab0814
      toggle_helper: input_boolean.awtrix_pool_pump
      my_sensor: sensor.pool_pump_status
      my_template_sensor:
        Pump {% if states('sensor.pool_pump_status') != 'Off' %}On{%
        else %}Off{% endif %}
      text_case: "2"
      text_color:
        - 148
        - 234
        - 255
      scroll: false
- id: "1737953704993"
  alias: Pool pump - set awtrix display toggle helper
  description: ""
  triggers:
    - trigger: state
      entity_id:
        - switch.pool_pump
  conditions: []
  actions:
    - if:
        - condition: state
          entity_id: switch.pool_pump
          state: "on"
      then:
        - action: input_boolean.turn_on
          metadata: {}
          data: {}
          target:
            entity_id: input_boolean.awtrix_pool_pump
      else:
        - action: input_boolean.turn_off
          metadata: {}
          data: {}
          target:
            entity_id: input_boolean.awtrix_pool_pump
  mode: single
- id: "1737955662765"
  alias: Pool heater - set awtrix display toggle helper
  description: ""
  triggers:
    - trigger: state
      entity_id:
        - climate.rostrevor_pool
  conditions: []
  actions:
    - choose:
        - conditions:
            - condition: state
              entity_id: climate.rostrevor_pool
              state: heat
          sequence:
            - action: input_boolean.turn_on
              metadata: {}
              data: {}
              target:
                entity_id: input_boolean.awtrix_toggle_pool_heater
        - conditions:
            - condition: state
              entity_id: climate.rostrevor_pool
              state: "off"
          sequence:
            - action: input_boolean.turn_off
              metadata: {}
              data: {}
              target:
                entity_id: input_boolean.awtrix_toggle_pool_heater
  mode: single
- id: "1737956116677"
  alias: Awtrix - pool heater
  description: ""
  use_blueprint:
    path: smarthomejunkie/awtrix_create_sensor_app.yaml
    input:
      awtrix_displays:
        - 90c7f72628fd10fb50e521f03eab0814
      toggle_helper: input_boolean.awtrix_toggle_pool_heater
      my_sensor: climate.rostrevor_pool
      my_template_sensor:
        PHtr {% if states('climate.rostrevor_pool') == "heat" %}On{%
        else %}Off{% endif %}
      text_color:
        - 148
        - 234
        - 255
      scroll: false
      text_case: "2"
- id: "1738965009475"
  alias: Fr24 - Parafield 1
  description: ""
  triggers:
    - trigger: event
      event_type: flightradar24_entry
  conditions:
    - condition: template
      value_template:
        "{{ trigger.event.data.tracked_by_device == 'Fr24-Parafield'
        and 'Flight Train' not in trigger.event.data.airline }}"
      enabled: true
  actions:
    - data:
        title: Fr24 Parafield
        message:
          '{%- if trigger.event.data.airline and trigger.event.data.airline !=
          "None" %}{{ trigger.event.data.airline }}{% endif -%} {%- if trigger.event.data.aircraft_model
          and trigger.event.data.aircraft_model != "None" %} {{ trigger.event.data.aircraft_model
          }}{% endif -%} {%- if trigger.event.data.flight_number and trigger.event.data.flight_number
          != "None" %} {{ trigger.event.data.flight_number }}{% endif -%} {%- if trigger.event.data.aircraft_registration
          and trigger.event.data.aircraft_registration != "None" %} {{ trigger.event.data.aircraft_registration
          }}{% endif -%} {%- if trigger.event.data.airport_origin_city and trigger.event.data.airport_origin_city
          != "None" %} from {{ trigger.event.data.airport_origin_city }}{% endif -%}
          {%- if trigger.event.data.airport_destination_city and trigger.event.data.airport_destination_city
          != "None" %} to {{ trigger.event.data.airport_destination_city }}{% endif
          -%}. [Open FlightRadar](https://www.flightradar24.com/{{ trigger.event.data.callsign
          }})'
        data:
          url:
            https://fr24.com/{{ trigger.event.data.callsign }}/{{ trigger.event.data.id
            }}
          image: "{{ trigger.event.data.aircraft_photo_medium }}"
      action: notify.mobile_app_patricks_iphone
  mode: single
- id: "1738966912134"
  alias: Fr24 - Aircraft in home area
  description: ""
  triggers:
    - trigger: event
      event_type: flightradar24_entry
  conditions:
    - alias: In Home area and exclude airlines
      condition: template
      value_template:
        "{{ trigger.event.data.tracked_by_device == 'Fr24-Home' and\n
        \  (\n     'Qantas' not in trigger.event.data.airline and\n     'Qatar' not
        in trigger.event.data.airline and\n     'Rex' not in trigger.event.data.airline
        and\n     'Jet Express' not in trigger.event.data.airline and\n     'Virgin'
        not in trigger.event.data.airline and\n     'Singapore' not in trigger.event.data.airline
        and\n     'Emirates' not in trigger.event.data.airline and\n     'Alliance'
        not in trigger.event.data.airline and\n     'Jetstar' not in trigger.event.data.airline
        and\n     'Training' not in trigger.event.data.airline\n   )\n}}"
      enabled: true
  actions:
    - data:
        title: Fr24 Home
        message:
          '{%- if trigger.event.data.airline and trigger.event.data.airline !=
          "None" %}{{ trigger.event.data.airline }}{% endif -%} {%- if trigger.event.data.aircraft_model
          and trigger.event.data.aircraft_model != "None" %} {{ trigger.event.data.aircraft_model
          }}{% endif -%} {%- if trigger.event.data.flight_number and trigger.event.data.flight_number
          != "None" %} {{ trigger.event.data.flight_number }}{% endif -%} {%- if trigger.event.data.aircraft_registration
          and trigger.event.data.aircraft_registration != "None" %} {{ trigger.event.data.aircraft_registration
          }}{% endif -%} {%- if trigger.event.data.airport_origin_city and trigger.event.data.airport_origin_city
          != "None" %} from {{ trigger.event.data.airport_origin_city }}{% endif -%}
          {%- if trigger.event.data.airport_destination_city and trigger.event.data.airport_destination_city
          != "None" %} to {{ trigger.event.data.airport_destination_city }}{% endif
          -%}. [Open FlightRadar](https://www.flightradar24.com/{{ trigger.event.data.callsign
          }})'
        data:
          url:
            https://fr24.com/{{ trigger.event.data.callsign }}/{{ trigger.event.data.id
            }}
          image: "{{ trigger.event.data.aircraft_photo_medium }}"
      action: notify.mobile_app_patricks_iphone
  mode: single
- id: "1738968088935"
  alias: Fr24 - Fire water bomber near home
  description: ""
  triggers:
    - trigger: event
      event_type: flightradar24_entry
  conditions:
    - condition: template
      value_template:
        "{{ trigger.event.data.tracked_by_device == 'Fr24-Home' and
        'Aerotech' in trigger.event.data.airline }}"
  actions:
    - data:
        title: Possible bushfire near home
        message:
          '{%- if trigger.event.data.airline and trigger.event.data.airline !=
          "None" %}{{ trigger.event.data.airline }}{% endif -%} {%- if trigger.event.data.aircraft_model
          and trigger.event.data.aircraft_model != "None" %} {{ trigger.event.data.aircraft_model
          }}{% endif -%} {%- if trigger.event.data.flight_number and trigger.event.data.flight_number
          != "None" %} {{ trigger.event.data.flight_number }}{% endif -%} {%- if trigger.event.data.aircraft_registration
          and trigger.event.data.aircraft_registration != "None" %} {{ trigger.event.data.aircraft_registration
          }}{% endif -%} {%- if trigger.event.data.airport_origin_city and trigger.event.data.airport_origin_city
          != "None" %} from {{ trigger.event.data.airport_origin_city }}{% endif -%}
          {%- if trigger.event.data.airport_destination_city and trigger.event.data.airport_destination_city
          != "None" %} to {{ trigger.event.data.airport_destination_city }}{% endif
          -%}. [Open FlightRadar](https://www.flightradar24.com/{{ trigger.event.data.callsign
          }})'
        data:
          url:
            https://fr24.com/{{ trigger.event.data.callsign }}/{{ trigger.event.data.id
            }}
          image: "{{ trigger.event.data.aircraft_photo_medium }}"
      action: notify.mobile_app_patricks_iphone
  mode: single
- id: "1738985635426"
  alias: Fr24 - Claremont CFS Airport
  description: ""
  triggers:
    - trigger: event
      event_type: flightradar24_entry
      enabled: true
    - trigger: numeric_state
      entity_id:
        - sensor.flightradar24_exited_area_3
      above: 0
      enabled: false
  conditions:
    - condition: template
      value_template:
        '{{ ''Claremont'' in trigger.event.data.tracked_by_device and
        "Aerotech" in trigger.event.data.airline }}'
      alias: From Claremont airport and aircraft is Aerotech
    - condition: template
      value_template: "{{ trigger.event.data.vertical_speed > 50 }}"
      alias: Aircraft is taking off
  actions:
    - data:
        title: Fr24 Claremont CFS
        message:
          '{%- if trigger.event.data.airline and trigger.event.data.airline !=
          "None" %}{{ trigger.event.data.airline }}{% endif -%} {%- if trigger.event.data.aircraft_model
          and trigger.event.data.aircraft_model != "None" %} {{ trigger.event.data.aircraft_model
          }}{% endif -%} {%- if trigger.event.data.flight_number and trigger.event.data.flight_number
          != "None" %} {{ trigger.event.data.flight_number }}{% endif -%} {%- if trigger.event.data.aircraft_registration
          and trigger.event.data.aircraft_registration != "None" %} {{ trigger.event.data.aircraft_registration
          }}{% endif -%} {%- if trigger.event.data.airport_origin_city and trigger.event.data.airport_origin_city
          != "None" %} from {{ trigger.event.data.airport_origin_city }}{% endif -%}
          {%- if trigger.event.data.airport_destination_city and trigger.event.data.airport_destination_city
          != "None" %} to {{ trigger.event.data.airport_destination_city }}{% endif
          -%}. [Open FlightRadar](https://www.flightradar24.com/{{ trigger.event.data.callsign
          }})'
        data:
          url:
            https://fr24.com/{{ trigger.event.data.callsign }}/{{ trigger.event.data.id
            }}
          image: "{{ trigger.event.data.aircraft_photo_medium }}"
      action: notify.mobile_app_patricks_iphone
  mode: single
- id: "1739589189732"
  alias: Jess toilet fan off 6 min after light off
  description: ""
  triggers:
    - trigger: state
      entity_id:
        - light.jess_toilet_light
      to: "off"
      for:
        hours: 0
        minutes: 6
        seconds: 0
    - trigger: state
      entity_id:
        - light.jess_toilet_light
      to: "off"
      for:
        hours: 0
        minutes: 0
        seconds: 10
      enabled: false
      alias: For testing - Jess light off for 10s
  conditions:
    - condition: state
      entity_id: switch.jess_toilet_fan
      state: "on"
  actions:
    - action: fan.turn_off
      metadata: {}
      data: {}
      target:
        entity_id: fan.jess_toilet_fan
  mode: single
- id: "1739589389075"
  alias: Jess toilet fan on when light on
  description: ""
  triggers:
    - trigger: state
      entity_id:
        - light.jess_toilet_light
      to: "on"
  conditions: []
  actions:
    - action: fan.turn_on
      metadata: {}
      data: {}
      target:
        entity_id: fan.jess_toilet_fan
  mode: single
- id: "1739590918858"
  alias: Ensuite fan auto off after 20 mins
  description: ""
  triggers:
    - trigger: state
      entity_id:
        - fan.ensuite_fan
      to: "on"
      for:
        hours: 0
        minutes: 20
        seconds: 0
  conditions: []
  actions:
    - action: fan.turn_off
      metadata: {}
      data: {}
      target:
        entity_id: fan.ensuite_fan
  mode: single
- id: "1740205212290"
  alias: Button - shelly tough Ivory
  description: ""
  triggers:
    - trigger: state
      entity_id:
        - event.shelly_blu_button1_477f_button
      attribute: event_type
      to: press
      id: single
    - trigger: state
      entity_id:
        - event.shelly_blu_button1_477f_button
      attribute: event_type
      to: double_press
      id: double
    - trigger: state
      entity_id:
        - event.shelly_blu_button1_477f_button
      attribute: event_type
      to: triple_press
      id: triple
  conditions: []
  actions:
    - choose:
        - conditions:
            - condition: trigger
              id:
                - single
          sequence:
            - action: cover.toggle
              metadata: {}
              data: {}
              target:
                entity_id: cover.pedestrian_gate
        - conditions:
            - condition: trigger
              id:
                - double
          sequence:
            - action: cover.toggle
              metadata: {}
              data: {}
              target:
                entity_id: cover.driveway_gate
        - conditions:
            - condition: trigger
              id:
                - triple
          sequence:
            - action: cover.toggle
              metadata: {}
              data: {}
              target:
                entity_id: cover.garage_door
  mode: single
- id: "1742588394829"
  alias: Notify zigbee unavailable
  description: ""
  triggers:
    - trigger: state
      entity_id:
        - binary_sensor.alfresco_door_contact
      to: unavailable
  conditions: []
  actions:
    - action: notify.mobile_app_patricks_iphone
      metadata: {}
      data:
        title: Zigbee unavailable
        message: "{{ trigger.to_state.attributes.friendly_name }} went unavailable"
  mode: single
